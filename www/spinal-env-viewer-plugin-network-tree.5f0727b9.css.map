{"mappings":"A;;;;;A;;;;;;;;;;A;;;;;;;;A;;;;A;;;;;;;;A;;;;A;;;;;;;;A;;;;;;;A;;;;;;;A;;;;;;;;A;;;;;;;;;A;;;;;;;A;;;;;;;;;;A;;;;;;;A;;;;A;;;;A;;;;;A;;;;A;;;;A;;;;;;;;A;;;;;;;;;A;;;;;A;;;;A;;;;;A;;;;;;;A;;;;;A;;;;;A;;;;;A;;;;;;;;;A;;;;;;;;A;;;;;A;;;;;A;;;;;;;;;;A;;;;;;A;;;;;;;;A;;;;;;;;A;;;;;;;;;A;;;;;A;;;;;;;A;;;;A;;;;;;A;;;;;;;A;;;;;;;;;A;;;;;A;;;;;;A;;;;;;;;;;;A;;;;A;;;;;;;;;A;;;;;;A;;;;;;A;;;;;A;;;;;;;;A;;;;;A;;;;;A;;;;;;A;;;;A;;;;A;;;;;;;A;;;;A;;;;A;;;;A;;;;;;A;;;;;;;;A;;;;A;;;;A;;;;;;A;;;;A;;;;;;A;;;;A;;;;;A;;;;;;;A;;;;;;;;;;;;A;;;;;;AOsIA;;;;;;AAQA;;;;;;;AAQA;;;;A;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAIA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAQA;;;;AAGA;;;;AAIA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;A;;;;AAWA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAQA;;;;;;AAKA;;;;;;;;;;AAWA;;;;;AAQA;;;;;;;AASA;;;;;;;AAMA;;;;;;;AAMA;;;;;AAIA;;;;;AAIA;;;;;;;;AAOA;;;;;;;;AAOA;;;;;;;AAMA;;;;;;;AAMA;;;;;;AAKA;;;;AAAA;;;;AAMA;;;;;AAIA;;;;;;;;;;;;;;;;;;;A;;;;;;AA4BA;;;;;;AAQA;;;;;;AAOA;;;;AAGA;;;;AAKA;;;;AAQA;;;;;;;;AAOA;;;;;AAIA;;;;AAGA;;;;;;AAKA;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAKA;;;;AAAA;;;;AAAA;;;;AAKA;;;;AAMA;;;;AAGA;EAEA;;;;;AAMA;;;;AAKA;;;;AASA;;;;;AAIA;;;;AAGA;;;;AAKA;;;;AAAA;;;;AAAA;;;;A;;;;;AASA;;;;AAGA;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAIA;;;;A;;;;AAMA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAIA;;;;AAGA;;;;AAGA;;;;AAGA;;;;AAMA;;;;;AAIA;;;;AAGA;;;;;AAWA;;;;;;;;;;;;;;;;;AAsBA;;;;;;;;;AAQA;;;;;AAYA;;;;;;;;;;;AAUA;;;;;AAIA;;;;;AAIA;;;;;;;;;AAQA;;;;AAWA;;;;;;;;AAQA;;;;AAGA;;;;AAIA;;;;AAGA;;;;A;;;;;A;;;;A;;;;;A;;;;;;A;;;;;A;;;;;A;;;;;A;;;;A;;;;;A;;;;;A;;;;;A;;;;;A;;;;;;;;A;;;;;;;;A;;;;;;;A;;;;;;;A;;;;;;;;;A;;;;;A;;;;;A;;;;;A;;;;;A;;;;;A;;;;;A;;;;;A;;;;A;;;;A;;;;;;;;A;;;;;;;;;A;;;;;A;;;;A;;;;;A;;;;;;A;;;;;A;;;;;A;;;;;;A;;;;;A;;;;;;A;;;;;A;;;;;;A;;;;;A;;;;;;;;A;;;;;;;;;A;;;;;A;;;;A;;;;;;;A;;;;;;A;;;;;;A;;;;;;;A;;;;;;;;A;;;;A;;;;;;;;A;;;;A;;;;;;A;;;;;;;;A;;;;;;A","sources":["node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/links/linkToGroupTemplate.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/links/LinkComponent.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/links/resultComponent.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/link_to_virtual_profil/linkAutomateToProfil.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/link_to_virtual_profil/confirmUnlikProfil.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/links/editLinks.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/link_to_virtual_profil/editLinksDialog.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/code-mirror/SpinalCodeMirror.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/network_dialogs/personalizedAttributeDialog.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/network_dialogs/personalizeNamingConvention.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/link_to_gtb/confirmLinkToGTB.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/links/configuration.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/dialogs/link_to_gtb/linkToGtbDialog.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/steps/configurationStep.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/steps/launchStep.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/steps/selectionStep.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/components/steps/namingConventionStep.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/panels/generateAutomateContext.vue","node_modules/spinal-env-viewer-plugin-network-tree/src/vue/panels/detailPanel.vue"],"sourcesContent":["<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n\n<template>\n  <div class=\"subContent\">\n    <div class=\"title\">\n      <div>{{title}}</div>\n    </div>\n\n    <md-content class=\"container md-scrollbar\">\n      <md-list>\n        <md-list-item class=\"list-item\"\n                      v-for=\"(item,index) in data\"\n                      :key=\"index\"\n                      @click=\"selectItem(item.id)\"\n                      :class=\"{'selected' : item.id === itemSelected}\"\n                      v-tooltip=\"item.name\">\n\n          <span class=\"md-list-item-text\">{{item.name}}</span>\n\n        </md-list-item>\n      </md-list>\n    </md-content>\n\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"linkToGroupTemplate\",\n  props: [\"data\", \"title\", \"itemSelected\", \"disableBtn\"],\n  methods: {\n    createEvent() {\n      this.$emit(\"create\");\n    },\n    selectItem(id) {\n      this.$emit(\"select\", id);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.subContent {\n  width: 100%;\n  height: 100%;\n}\n\n.subContent .title {\n  width: 100%;\n  height: 10%;\n  /* text-align: center; */\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0 15px 0 15px;\n  border-bottom: 1px dashed grey;\n}\n\n.subContent .container {\n  width: 100%;\n  height: 90%;\n  padding: 0px !important;\n  /* border: 1px solid red; */\n  overflow: hidden;\n  overflow-y: auto;\n}\n\n.subContent .container .list-item {\n  border-bottom: 1px solid grey;\n}\n\n.subContent .container .list-item .md-list-item-text {\n  width: 100%;\n  display: block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.subContent .container .list-item.selected {\n  background-color: #448aff;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n   <div class=\"selection_container\">\n      <div :class=\"isAutomate ? 'section' : 'middle'\">\n         <link-template\n            :title=\"context_title\"\n            :data=\"data\"\n            :itemSelected=\"contextSelected\"\n            @select=\"selectContext\"\n         ></link-template>\n      </div>\n\n      <div :class=\"isAutomate ? 'section' : 'middle'\">\n         <link-template\n            :title=\"category_title\"\n            :data=\"profils\"\n            :itemSelected=\"profilSelected\"\n            @select=\"selectProfil\"\n         ></link-template>\n\n      </div>\n\n      <div\n         class=\"section\"\n         v-if=\"isAutomate\"\n      >\n         <link-template\n            :title=\"group_title\"\n            :data=\"devices\"\n            :itemSelected=\"deviceSelected\"\n            @select=\"selectDevice\"\n         ></link-template>\n      </div>\n   </div>\n</template>\n\n\n<script>\nimport LinkToGroupTemplate from \"./linkToGroupTemplate.vue\";\n\nexport default {\n   name: \"selectionComponent\",\n   props: {\n      context_title: {},\n      category_title: {},\n      group_title: {},\n      data: {},\n      profils: {},\n      devices: {},\n      contextSelected: {},\n      profilSelected: {},\n      deviceSelected: {},\n      isAutomate: {\n         type: Boolean,\n         default: true,\n      },\n   },\n   components: { \"link-template\": LinkToGroupTemplate },\n   methods: {\n      selectContext(res) {\n         this.$emit(\"selectContext\", res);\n      },\n\n      selectProfil(res) {\n         this.$emit(\"selectProfil\", res);\n      },\n\n      selectDevice(res) {\n         this.$emit(\"selectDevice\", res);\n      },\n   },\n};\n</script>\n\n<style scoped>\n.selection_container {\n   width: 100%;\n   height: 100%;\n   display: flex;\n   justify-content: space-between;\n   align-items: stretch;\n}\n\n.selection_container .section {\n   width: 33%;\n   border: 1px solid grey;\n   border-radius: 4% 4% 0 0;\n   padding: 15px;\n}\n\n.selection_container .middle {\n   width: 49%;\n   border: 1px solid grey;\n   border-radius: 4% 4% 0 0;\n   padding: 15px;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <div class=\"result_container\">\n    <div class=\"title\"\n         v-tooltip=\"results.automate.name\">{{results.automate.name}}</div>\n    <div class=\"content\">\n\n      <div class=\"valids textDiv\"\n           v-tooltip=\"`${results.valids.length} Items linked`\">\n        <div class=\"value\">{{results.valids.length}}</div>\n        <div class=\"name\">Items linked</div>\n      </div>\n\n      <div class=\"invalids textDiv\"\n           v-tooltip=\"`${results.invalidAutomateItems.length} Items not linked`\">\n        <div class=\"value\">{{results.invalidAutomateItems.length}}</div>\n        <div class=\"name\">Items not linked</div>\n      </div>\n\n      <div class=\"button\">\n        <md-button class=\"md-raised md-primary\"\n                   @click=\"editLink\">Edit</md-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { spinalPanelManagerService } from \"spinal-env-viewer-panel-manager-service\";\n// import Vue from \"vue\";\n// Vue.forceUpdate();\n\nexport default {\n  name: \"resultComponent\",\n  props: {\n    // automate: {},\n    results: {},\n  },\n  data() {\n    return {\n      // renderComponent: true,\n    };\n  },\n  methods: {\n    editLink() {\n      spinalPanelManagerService.openPanel(\"editAutomateLinkDialog\", {\n        data: this.results,\n        nodeId: this.results.automate.id,\n        callback: (dataEdited) => {\n          console.log(\"dataEdited\", dataEdited);\n          this.$emit(\"edit\", {\n            automateId: this.results.automate.id,\n            value: dataEdited,\n          });\n        },\n      });\n    },\n\n    forceRerender() {\n      this.$forceUpdate();\n    },\n  },\n};\n</script>\n\n<style scoped>\n.result_container {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.result_container .title {\n  width: 40%;\n  font-size: 1em;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  /* text-align: center; */\n  padding: 5px;\n}\n\n.result_container .content {\n  width: 45%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.result_container .content .textDiv {\n  max-width: 100px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.2em;\n  margin-right: 5px;\n}\n\n.result_container .content .textDiv .name {\n  width: 100%;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n.result_container .content .textDiv.invalids {\n  color: #ff5252;\n}\n\n.result_container .content .textDiv.valids {\n  color: #448aff;\n}\n\n/* .result_container .title {\n   width: 100%;\n   height: 20%;\n   display: block;\n   overflow: hidden;\n   white-space: nowrap;\n   text-overflow: ellipsis;\n   text-align: center;\n   padding: 5px;\n   background: grey;\n}\n\n.result_container .content {\n   width: 100%;\n   height: 80%;\n   padding: 5px;\n   display: flex;\n   flex-direction: column;\n   justify-content: space-around;\n   align-items: center;\n}\n\n.result_container .content .textDiv {\n   font-size: 1.5em;\n} */\n</style>\n","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <md-dialog class=\"mdDialogContainer\"\n             :md-active.sync=\"showDialog\"\n             @md-closed=\"closeDialog(false)\">\n    <md-dialog-title class=\"dialogTitle\">Link Automates to Profil\n    </md-dialog-title>\n    <md-dialog-content class=\"content\">\n      <link-component v-if=\"pageSelected === PAGES.selection\"\n                      :context_title=\"'Profils'\"\n                      :category_title=\"'Categories'\"\n                      :group_title=\"'Devices'\"\n                      :data=\"data\"\n                      :profils=\"profils\"\n                      :devices=\"devices\"\n                      :contextSelected=\"contextSelected\"\n                      :profilSelected=\"profilSelected\"\n                      :deviceSelected=\"deviceSelected\"\n                      @selectContext=\"selectContext\"\n                      @selectProfil=\"selectProfil\"\n                      @selectDevice=\"selectDevice\"></link-component>\n\n      <md-content class=\"results md-scrollbar\"\n                  v-else-if=\"pageSelected === PAGES.result\">\n        <result-component v-for=\"item in linkResult\"\n                          class=\"result-component\"\n                          :ref=\"`result-${item.automate.id}`\"\n                          :key=\"item.automate.id\"\n                          :results=\"item\"\n                          @edit=\"editAutomateLinks\">\n        </result-component>\n      </md-content>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.loading\">\n        <md-progress-spinner md-mode=\"indeterminate\"></md-progress-spinner>\n      </div>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.success\">\n        <md-icon class=\"md-size-5x\">done</md-icon>\n      </div>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.error\">\n        <md-icon class=\"md-size-5x\">error_outline</md-icon>\n      </div>\n\n      <div class=\"progress-bar\"\n           v-else-if=\"pageSelected === PAGES.creation\">\n        <div class=\"percent-number\">{{percent}} %</div>\n        <md-progress-bar class=\"percent-bar\"\n                         md-mode=\"buffer\"\n                         :md-value=\"percent\"></md-progress-bar>\n      </div>\n\n    </md-dialog-content>\n\n    <md-dialog-actions>\n      <md-button class=\"md-primary\"\n                 @click=\"closeDialog(false)\">Close</md-button>\n\n      <md-button class=\"md-primary\"\n                 :disabled=\"disabled()\"\n                 v-if=\"pageSelected === PAGES.selection\"\n                 @click=\"goToNext\">Next</md-button>\n\n      <md-button class=\"md-primary\"\n                 v-if=\"pageSelected === PAGES.result\"\n                 @click=\"goToPreviousStep\">Previous</md-button>\n\n      <md-button class=\"md-primary\"\n                 v-if=\"pageSelected === PAGES.result\"\n                 @click=\"createLinks\">Save</md-button>\n\n    </md-dialog-actions>\n  </md-dialog>\n\n</template>\n\n<script>\nimport EventBus from \"spinal-env-viewer-room-manager/js/event\";\n// import deviceProfilService from \"../../../js/devices_profil_services\";\n\n// import linkAutomateToProfilUtilities from \"../../../js/link_utilities/linkAutomateToProfil\";\nimport {\n  LinkNetworkTreeService,\n  DeviceProfileUtilities,\n} from \"spinal-env-viewer-plugin-network-tree-service\";\n\nimport LinkComponent from \"../../components/links/LinkComponent.vue\";\nimport ResultComponent from \"../../components/links/resultComponent.vue\";\n\nimport { SpinalGraphService } from \"spinal-env-viewer-graph-service\";\nimport { BIM_OBJECT_TYPE } from \"spinal-env-viewer-plugin-forge/dist/Constants\";\n\nexport default {\n  name: \"dialogComponent\",\n  components: {\n    \"link-component\": LinkComponent,\n    \"result-component\": ResultComponent,\n  },\n  props: [\"onFinised\"],\n  data() {\n    this.physicalParams;\n\n    this.PAGES = {\n      selection: 0,\n      result: 1,\n      loading: 2,\n      creation: 3,\n      success: 4,\n      error: 5,\n    };\n\n    // this.validMaps = new Map();\n    // this.invalidMaps = new Map();\n\n    return {\n      percent: 0,\n      resultMaps: new Map(),\n      showDialog: true,\n      pageSelected: this.PAGES.selection,\n\n      data: [],\n      profils: [],\n      devices: [],\n\n      contextSelected: undefined,\n      profilSelected: undefined,\n      deviceSelected: undefined,\n      callback: undefined,\n      linkResult: [],\n    };\n  },\n\n  mounted() {\n    EventBus.$on(\"itemCreated\", (id) => {\n      this.pageSelected = this.PAGES.loading;\n\n      this.getAllData().then(() => {\n        this.pageSelected = this.PAGES.selection;\n      });\n    });\n  },\n\n  methods: {\n    async opened(option) {\n      // this.physicalContextId = option.contextId;\n      // // this.physicalProfilId = option.nodeId;\n      // this.automates = option.automates;\n      this.pageSelected = this.PAGES.loading;\n\n      this.callback = option.callback;\n\n      Promise.all([\n        this.getAllData(),\n        this.getAutomates(option.contextId, option.nodeId),\n      ]).then(([data, automates]) => {\n        this.physicalParams = {\n          contextId: option.contextId,\n          automates: automates.map((el) => el.get()),\n        };\n\n        this.data = data;\n        this.updateProfils();\n\n        this.pageSelected = this.PAGES.selection;\n      });\n    },\n\n    removed(option) {\n      this.showDialog = false;\n    },\n\n    closeDialog(closeResult) {\n      if (typeof this.onFinised === \"function\") {\n        this.onFinised(closeResult);\n      }\n    },\n\n    getAutomates(contextId, nodeId) {\n      const nodeInfo = SpinalGraphService.getInfo(nodeId);\n      if (\n        nodeInfo.type.get() === BIM_OBJECT_TYPE &&\n        nodeInfo.isAutomate &&\n        nodeInfo.isAutomate.get()\n      ) {\n        return Promise.resolve([nodeInfo]);\n      }\n\n      return SpinalGraphService.findInContext(nodeId, contextId, (node) => {\n        if (\n          node.getType().get() === BIM_OBJECT_TYPE &&\n          node.info.isAutomate &&\n          node.info.isAutomate.get()\n        ) {\n          SpinalGraphService._addNode(node);\n          return true;\n        }\n        return false;\n      });\n    },\n\n    async createLinks() {\n      this.pageSelected = this.PAGES.creation;\n\n      let isError = false;\n      const liste = Array.from(this.resultMaps.keys()).map((key) => {\n        return [key, this.resultMaps.get(key)];\n      });\n\n      const listeLength = liste.length;\n\n      while (!isError && liste.length > 0) {\n        const item = liste.shift();\n        if (item) {\n          console.log(item);\n          const [key, value] = item;\n          try {\n            await LinkNetworkTreeService.linkProfilToDevice(\n              key,\n              this.deviceSelected,\n              value.valids\n            );\n            this.percent = Math.floor(\n              (100 * (listeLength - liste.length)) / listeLength\n            );\n          } catch (err) {\n            console.error(err);\n            isError = true;\n          }\n        }\n      }\n\n      if (isError) {\n        this.pageSelected = this.PAGES.error;\n        return;\n      }\n\n      this.pageSelected = this.PAGES.success;\n\n      // this.linkNode(liste, this.deviceSelected, liste.length)\n      //    .then(() => {\n      //       this.pageSelected = this.PAGES.success;\n      //    })\n      //    .catch((err) => {\n      //       console.error(err);\n      //       this.pageSelected = this.PAGES.error;\n      //    });\n    },\n\n    // linkNode(liste, deviceProfilId, listeLength) {\n    //    return new Promise((resolve, reject) => {\n    //       this.linkNodeRecur(liste, deviceProfilId, listeLength, resolve);\n    //    });\n    // },\n\n    // linkNodeRecur(liste, deviceProfilId, listeLength, resolve) {\n    //    const item = liste.shift();\n    //    if (item) {\n    //       const [key, value] = item;\n    //       // linkAutomateToProfilUtilities\n    //       LinkNetworkTreeService.linkProfilToDevice(\n    //          key,\n    //          deviceProfilId,\n    //          value.valids\n    //       )\n    //          .then(() => {\n    //             this.percent = Math.floor(\n    //                (100 * (listeLength - liste.length)) / listeLength\n    //             );\n\n    //             this.linkNodeRecur(\n    //                liste,\n    //                deviceProfilId,\n    //                listeLength,\n    //                resolve\n    //             );\n    //          })\n    //          .catch(() => {\n    //             this.percent = Math.floor(\n    //                (100 * (listeLength - liste.length)) / listeLength\n    //             );\n\n    //             this.linkNodeRecur(\n    //                liste,\n    //                deviceProfilId,\n    //                listeLength,\n    //                resolve\n    //             );\n    //          });\n    //    } else {\n    //       resolve(true);\n    //    }\n    // },\n\n    getAllData() {\n      // return deviceProfilService\n      return DeviceProfileUtilities.getDeviceContextTreeStructure();\n      // .then(\n      //    (result) => {\n      //       this.data = result;\n      //       this.updateProfils();\n      //       return;\n      //    }\n      // );\n    },\n\n    disabled() {\n      return !(this.contextSelected && this.deviceSelected);\n    },\n\n    /* Change Step */\n\n    goToPreviousStep() {\n      this.pageSelected = this.PAGES.selection;\n    },\n\n    goToNext() {\n      this.pageSelected = this.PAGES.loading;\n      const virtualItems = this.getItemsList(this.deviceSelected);\n      return this.createMaps(virtualItems)\n        .then(() => {\n          this.pageSelected = this.PAGES.result;\n        })\n        .catch((err) => {\n          this.pageSelected = this.PAGES.error;\n        });\n    },\n\n    createMaps(virtualItems) {\n      // return linkAutomateToProfilUtilities\n      console.log(this.physicalParams.automates, virtualItems);\n\n      return LinkNetworkTreeService.createMaps(\n        this.physicalParams.automates,\n        virtualItems\n      ).then((resultMap) => {\n        this.resultMaps = resultMap;\n        this.linkResult = Array.from(resultMap.values());\n      });\n    },\n\n    /** */\n    editAutomateLinks(res) {\n      const { automateId, value } = res;\n      this.resultMaps.set(automateId, value);\n\n      this.linkResult = Array.from(this.resultMaps.values());\n\n      // // if (this.$refs[`result-${res.automateId}`]) {\n      // //   const [ref] = this.$refs[`result-${res.automateId}`];\n      // //   console.log(ref);\n      // //   if (ref) ref.forceRerender();\n      // // }\n      // const keysIterator = this.resultMaps.keys();\n      // let processing = true;\n      // let next;\n\n      // do {\n      //    next = keysIterator.next().value;\n      //    if (typeof next === \"undefined\") {\n      //       processing = false;\n      //    } else if (next === res.automateId) {\n      //       // console.log(next, res.automateId);\n      //       this.resultMaps.set(next, res.value);\n      //       // console.log(this.resultMaps);\n      //       this.$forceUpdate();\n      //       // const reference = this.$refs[`result-${res.automateId}`][0];\n      //       // reference.forceRerender();\n      //       processing = false;\n      //    }\n      // } while (processing);\n    },\n\n    getItemsList(deviceId) {\n      const found = this.devices.find((el) => el.id === deviceId);\n      if (found) return found.itemList;\n    },\n\n    /* Selection */\n    selectContext(id) {\n      this.contextSelected = id;\n    },\n\n    selectProfil(id) {\n      this.profilSelected = id;\n    },\n\n    selectDevice(id) {\n      this.deviceSelected = id;\n    },\n\n    /* Update */\n    updateProfils() {\n      this.categories = [];\n      if (this.contextSelected) {\n        let val = this.data.find((el) => el.id === this.contextSelected);\n        if (val) this.profils = val.profils;\n      }\n    },\n\n    updateDevices() {\n      this.devices = [];\n      if (this.profilSelected) {\n        let val = this.profils.find((el) => el.id === this.profilSelected);\n        if (val) this.devices = val.devices;\n      }\n    },\n  },\n  //   computed: {\n  //     linkResult() {\n  //       return Array.from(this.resultMaps.values());\n  //     },\n  //   },\n  watch: {\n    async contextSelected() {\n      await this.updateProfils();\n      this.profilSelected = undefined;\n    },\n    async profilSelected() {\n      this.updateDevices();\n      this.deviceSelected = undefined;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.mdDialogContainer {\n  width: 60%;\n  height: 600px;\n}\n\n.mdDialogContainer .dialogTitle {\n  text-align: center;\n}\n\n.mdDialogContainer .content {\n  padding: 0 10px 24px 24px;\n}\n\n.mdDialogContainer .content .state {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.mdDialogContainer .content .progress-bar {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.mdDialogContainer .content .progress-bar .percent-number {\n  font-size: 1.8em;\n  margin-bottom: 10px;\n}\n\n.mdDialogContainer .content .progress-bar .percent-bar {\n  width: 90%;\n}\n\n.mdDialogContainer .content .results {\n  width: 100%;\n  height: 100%;\n  /* display: flex;\n  justify-content: space-between;\n  flex-wrap: wrap;\n  overflow: auto; */\n}\n\n.mdDialogContainer .content .results .result-component {\n  width: 100%;\n  height: 70px;\n  border: 1px solid gray;\n  margin: 5px 0 5px 0;\n}\n\n/* .mdDialogContainer .content {\n  display: flex;\n  justify-content: space-between;\n  align-items: stretch;\n}\n\n.mdDialogContainer .content .section {\n  width: 33%;\n  border: 1px solid grey;\n  border-radius: 4% 4% 0 0;\n  padding: 15px;\n} */\n\n/* .mdIcon {\n  display: flex;\n  align-items: center;\n} */\n</style>\n\n<style>\n.mdDialogContainer .md-dialog-container {\n  max-width: 100%;\n  max-height: 100%;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <md-dialog class=\"mdDialogContainer\"\n             :md-active.sync=\"showDialog\"\n             @md-closed=\"closeDialog(false)\">\n    <md-dialog-title style=\"text-align : center\">Unlink Profil</md-dialog-title>\n    <md-dialog-content>\n      <div class=\"content\">\n        <div class=\"normal\"\n             v-if=\"state == STATES.normal\">\n          <div>\n            <!-- style=\"text-align : center\" -->\n            Do you want to delete the profil link ?\n          </div>\n          <div>\n            <md-checkbox v-model=\"unLinkAlsoBmsDevice\"\n                         class=\"md-primary\">Remove Also bmsDevices</md-checkbox>\n          </div>\n        </div>\n        <div class=\"state\"\n             v-else>\n          <md-progress-spinner md-mode=\"indeterminate\"\n                               v-if=\"state == STATES.loading\">\n          </md-progress-spinner>\n          <md-icon class=\"md-size-5x\"\n                   v-else-if=\"state == STATES.success\">done</md-icon>\n          <md-icon class=\"md-size-5x\"\n                   v-else-if=\"state == STATES.error\">error</md-icon>\n        </div>\n      </div>\n\n    </md-dialog-content>\n    <md-dialog-actions>\n      <md-button class=\"md-primary\"\n                 @click=\"closeDialog(false)\">No</md-button>\n      <md-button class=\"md-primary\"\n                 :disabled=\"state != STATES.normal\"\n                 @click=\"removeLink\">Yes</md-button>\n    </md-dialog-actions>\n  </md-dialog>\n</template>\n\n<script>\nimport unlinkController from \"../../../js/controllers/links/unLinkProfilController\";\n\nexport default {\n  name: \"confirmUnlikProfilDialog\",\n  props: [\"onFinised\"],\n  data() {\n    this.contextId;\n    this.nodeId;\n\n    this.STATES = {\n      loading: 1,\n      normal: 2,\n      error: 3,\n      success: 4,\n    };\n    return {\n      state: this.STATES.normal,\n      showDialog: true,\n      unLinkAlsoBmsDevice: true,\n    };\n  },\n  methods: {\n    opened(option) {\n      this.contextId = option.contextId;\n      this.nodeId = option.nodeId;\n    },\n\n    async removeLink() {\n      try {\n        this.state = this.STATES.loading;\n        await unlinkController.unLink(\n          this.contextId,\n          this.nodeId,\n          this.unLinkAlsoBmsDevice\n        );\n        this.state = this.STATES.success;\n      } catch (error) {\n        console.error(error);\n        this.state = this.STATES.error;\n      }\n    },\n\n    removed(option) {\n      // if (typeof this.callback === \"function\") {\n      //   this.callback(option);\n      // }\n      this.showDialog = false;\n    },\n    closeDialog(closeResult) {\n      if (typeof this.onFinised === \"function\") {\n        this.onFinised(closeResult);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.mdDialogContainer {\n  width: 500px;\n  height: 500px;\n}\n\n.mdDialogContainer .md-dialog-container {\n  max-width: 100%;\n  max-height: 100%;\n}\n\n.content {\n  width: 100%;\n  height: 100%;\n  font-size: 1.5em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <div class=\"link_container\"\n       v-if=\"data\">\n    <div class=\"links md-scrollbar\">\n      <div class=\"title\">Items Linked</div>\n      <div class=\"content\">\n        <div class=\"linkedTemplate\"\n             v-for=\"(item,index) of data.valids\"\n             :key=\"index\">\n          <div class=\"itemsLinked\"\n               v-tooltip=\"item.automateItem.name\">\n            <span>{{item.automateItem.name}}</span>\n          </div>\n          <div class=\"unlinkButton\">\n            <md-button class=\"md-icon-button md-raised unlink\"\n                       @click=\"unLinkItems(item.automateItem.id,item.profileItem.id)\"\n                       v-tooltip=\"'unlink'\">\n              <md-icon>link_off</md-icon>\n            </md-button>\n          </div>\n          <div class=\"itemsLinked\"\n               v-tooltip=\"item.profileItem.name\">\n            <span>{{item.profileItem.name}}</span>\n          </div>\n        </div>\n      </div>\n\n    </div>\n    <!-- \n  ////////////////////////////////////////////////////////////\n  //                    Items\n  ////////////////////////////////////////////////////////////\n -->\n    <div class=\"items\">\n      <div class=\"physical_automates\">\n        <div class=\"title\">{{leftTitle}}</div>\n        <div class=\"lists\">\n          <div class=\"list\"\n               v-if=\"data.invalidAutomateItems.length > 0\">\n            <div class=\"listItem\"\n                 v-for=\"automateItem of data.invalidAutomateItems\"\n                 :key=\"automateItem.id\"\n                 v-tooltip=\"automateItem.name\">\n              <!-- <md-checkbox class=\"md-primary\"\n                           v-model=\"automateItem.checked\"\n                           value=\"preview\" />\n              <span class=\"md-list-item-text\">{{automateItem.name}}</span> -->\n              <md-radio class=\"md-primary\"\n                        v-model=\"automateItemSelected\"\n                        :value=\"automateItem.id\">\n                {{automateItem.name}}\n              </md-radio>\n            </div>\n          </div>\n\n          <div v-else\n               class=\"allItemsLinked\">\n            All items are linked\n          </div>\n        </div>\n      </div>\n\n      <div class=\"linkButton\">\n        <md-button class=\"md-icon-button md-raised md-primary\"\n                   @click=\"linkItems()\"\n                   :disabled=\"disableLink()\">\n          <md-icon>add_link</md-icon>\n        </md-button>\n      </div>\n\n      <div class=\"virtual_automates\">\n        <div class=\"title\">{{rightTitle}}</div>\n        <div class=\"lists\">\n          <div class=\"list\"\n               v-if=\"data.invalidProfileItems.length > 0\">\n            <div class=\"listItem\"\n                 v-for=\"profileItem of data.invalidProfileItems\"\n                 :key=\"profileItem.id\"\n                 v-tooltip=\"profileItem.name\">\n              <!-- <md-checkbox class=\"md-primary\"\n                           v-model=\"profileItem.checked\"\n                           value=\"preview\" />\n              <span class=\"md-list-item-text\">{{profileItem.name}}</span> -->\n              <md-radio class=\"md-primary\"\n                        v-model=\"profileItemSelected\"\n                        :value=\"profileItem.id\">\n                {{profileItem.name}}\n              </md-radio>\n            </div>\n          </div>\n\n          <div v-else\n               class=\"allItemsLinked\">\n            All items are linked\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  <div class=\"loading\"\n       v-else>\n    loading...\n  </div>\n</template>\n\n<script>\nimport editListController from \"../../../js/controllers/links/editLinksControllers\";\n\nexport default {\n  name: \"editLinkComponent\",\n  props: {\n    leftTitle: {},\n    rightTitle: {},\n    data: {},\n  },\n  data() {\n    return {\n      automateItemSelected: undefined,\n      profileItemSelected: undefined,\n    };\n  },\n  methods: {\n    linkItems() {\n      let automateItemList = this.data.invalidAutomateItems;\n      let profileItemList = this.data.invalidProfileItems;\n      const validList = this.data.valids;\n\n      this.data.valids = editListController.moveItemTovalidList(\n        automateItemList,\n        profileItemList,\n        this.automateItemSelected,\n        this.profileItemSelected,\n        validList\n      );\n\n      this.automateItemSelected = undefined;\n      this.profileItemSelected = undefined;\n    },\n\n    unLinkItems(automateItemId, profileItemId) {\n      let automateItemList = this.data.invalidAutomateItems;\n      let profileItemList = this.data.invalidProfileItems;\n      const validList = this.data.valids;\n\n      editListController\n        .removeItemFromValidList(\n          validList,\n          automateItemList,\n          profileItemList,\n          automateItemId,\n          profileItemId\n        )\n        .then(({ invalidAutomateItems, invalidProfileItems, validList }) => {\n          this.data.invalidAutomateItems = invalidAutomateItems;\n          this.data.invalidProfileItems = invalidProfileItems;\n          this.data.valids = validList;\n        });\n    },\n\n    disableLink() {\n      return (\n        typeof this.automateItemSelected === \"undefined\" ||\n        typeof this.profileItemSelected === \"undefined\"\n      );\n    },\n  },\n};\n</script>\n\n<style scoped>\n.link_container {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.link_container .links,\n.link_container .items {\n  width: 100%;\n  height: 49%;\n}\n\n.link_container .links {\n  border: 1px solid grey;\n  overflow-y: auto;\n}\n\n.link_container .links .title {\n  width: 100%;\n  height: 50px;\n  /* background: grey; */\n  margin: auto;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-bottom: 1px solid grey;\n}\n\n.link_container .links .content {\n  width: 100%;\n  height: calc(100% - 50px);\n  overflow: auto;\n}\n\n.link_container .links .content .linkedTemplate {\n  width: 98%;\n  height: 50px;\n  display: flex;\n  margin: auto;\n  background: #686464;\n  margin-top: 10px;\n  margin-bottom: 5px;\n\n  /* padding: 5px 0; */\n}\n\n.link_container .links .content .linkedTemplate .itemsLinked {\n  width: calc(50% - 30px);\n  height: 100%;\n  display: flex;\n  /* justify-content: center; */\n  align-items: center;\n  text-align: center;\n}\n\n.link_container .links .content .linkedTemplate .itemsLinked span {\n  max-width: 95%;\n  font-size: 16px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-left: 10px;\n}\n\n.link_container .links .content .linkedTemplate .unlinkButton {\n  width: 50px;\n  height: 100%;\n\n  /* border: 1px solid grey; */\n}\n\n.link_container .links .content .linkedTemplate .unlinkButton .unlink {\n  width: 100%;\n  height: 100%;\n  margin: 0px;\n  box-shadow: unset;\n  /* border-right: 2px solid white;\n  border-left: 2px solid white; */\n}\n\n.link_container .items {\n  display: flex;\n  /* justify-content: space-between; */\n}\n\n.link_container .items .physical_automates,\n.link_container .items .virtual_automates {\n  width: calc(50% - 30px);\n  height: 100%;\n  border: 1px solid grey;\n}\n\n.link_container .items .linkButton {\n  width: 60px;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.link_container .items .physical_automates .title,\n.link_container .items .virtual_automates .title {\n  width: 100%;\n  height: 50px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid grey;\n  /* background: grey; */\n}\n\n.link_container .items .physical_automates .lists,\n.link_container .items .virtual_automates .lists {\n  width: 100%;\n  height: calc(100% - 50px);\n  /* overflow-y: auto; */\n}\n\n.link_container .items .physical_automates .lists .list,\n.link_container .items .virtual_automates .lists .list {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n}\n\n.link_container .items .physical_automates .lists .list .listItem,\n.link_container .items .virtual_automates .lists .list .listItem {\n  width: 100%;\n  height: 50px;\n  display: flex;\n  align-items: center;\n  font-size: 16px;\n  font-weight: 400;\n  text-align: left;\n  padding: 4px 16px;\n}\n\n.link_container .items .physical_automates .lists .list .listItem:hover,\n.link_container .items .virtual_automates .lists .list .listItem:hover {\n  background: grey;\n}\n\n.link_container .items .allItemsLinked {\n  width: 100%;\n  height: calc(100% - 50px);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 1.5em;\n}\n</style>\n\n<style>\n.link_container .items .physical_automates .lists .md-radio,\n.link_container .items .virtual_automates .lists .md-radio {\n  width: 100%;\n  padding: 0px;\n  margin: 0px;\n}\n\n.link_container .items .physical_automates .lists .md-radio .md-radio-label,\n.link_container .items .virtual_automates .lists .md-radio .md-radio-label {\n  width: calc(100% - 40px);\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <md-dialog :md-active.sync=\"showDialog\"\n             @md-closed=\"closeDialog(false)\"\n             class=\"linkerDialogsContent\">\n    <md-dialog-title style=\"text-align : center\">Edit Profil Link\n    </md-dialog-title>\n\n    <md-dialog-content>\n      <edit-link v-if=\"!success\"\n                 :data=\"data\"\n                 :rightTitle=\"'Profil Items'\"\n                 :leftTitle=\"'Automate Items'\"></edit-link>\n\n      <div class=\"centered\"\n           v-else>\n        <md-icon class=\"md-size-5x\">done</md-icon>\n      </div>\n    </md-dialog-content>\n\n    <md-dialog-actions>\n      <md-button class=\"md-primary\"\n                 @click=\"closeDialog(false)\">close</md-button>\n\n      <md-button class=\"md-primary\"\n                 :disabled=\"success\"\n                 @click=\"editLink\">Save</md-button>\n    </md-dialog-actions>\n  </md-dialog>\n</template>\n\n\n<script>\nimport {\n  LinkNetworkTreeService,\n  CONSTANTS,\n} from \"spinal-env-viewer-plugin-network-tree-service\";\n\nimport editLinkContent from \"../../components/links/editLinks.vue\";\n\nexport default {\n  name: \"editLinksDialog\",\n  props: [\"onFinised\"],\n  components: {\n    \"edit-link\": editLinkContent,\n  },\n  data() {\n    this.callback;\n\n    return {\n      success: false,\n      showDialog: true,\n      data: undefined,\n    };\n  },\n  methods: {\n    async opened(option) {\n      if (option.data) {\n        console.log(\"inside data\");\n        this.data = JSON.parse(JSON.stringify(option.data));\n        this.callback = option.callback;\n        return;\n      }\n      // this.data = JSON.parse(JSON.stringify(option.data));\n      this.data = await LinkNetworkTreeService.getDeviceAndProfilData(\n        option.nodeId\n      );\n      // this.callback = option.callback;\n    },\n\n    async editLink() {\n      if (typeof this.callback === \"function\") {\n        console.log(\"this.callback is a function\");\n        return this.closeDialog(true);\n      }\n      const validPromises = this.data.valids.map(\n        ({ automateItem, profileItem }) =>\n          LinkNetworkTreeService.linkAutomateItemToProfilItem(\n            automateItem.id,\n            profileItem.id\n          )\n      );\n\n      await Promise.all(validPromises);\n\n      const invaliPromises = this.data.invalidAutomateItems.map((el) =>\n        LinkNetworkTreeService.unLinkAutomateItemToProfilItem(el.id)\n      );\n      await Promise.all(invaliPromises);\n\n      this.success = true;\n    },\n\n    async removed(option) {\n      if (option && typeof this.callback === \"function\") {\n        this.callback(this.data);\n        // const validPromises = this.data.valids.map(\n        //    ({ automateItem, profileItem }) =>\n        //       LinkNetworkTreeService.linkAutomateItemToProfilItem(\n        //          automateItem.id,\n        //          profileItem.id\n        //       )\n        // );\n        // await Promise.all(validPromises).then(() => {\n        //    const invaliPromises = res.invalidAutomateItems.map((el) =>\n        //       LinkNetworkTreeService.unLinkAutomateItemToProfilItem(el.id)\n        //    );\n        //    return Promise.all(invaliPromises);\n        // });\n      }\n\n      this.showDialog = false;\n    },\n\n    closeDialog(closeResult) {\n      if (typeof this.onFinised === \"function\") {\n        this.onFinised(closeResult);\n      }\n    },\n\n    // _formatInvalidData(data) {\n    //   console.log(\"data\", data);\n    //   data.invalidAutomateItems = data.invalidAutomateItems.map((el) => {\n    //     el.checked = false;\n    //     return el;\n    //   });\n    //   data.invalidProfileItems = data.invalidProfileItems.map((el) => {\n    //     el.checked = false;\n    //     return el;\n    //   });\n\n    //   return data;\n    // },\n  },\n};\n</script>\n\n<style scoped>\n.linkerDialogsContent {\n  width: 100%;\n  height: 100%;\n}\n\n.centered {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n</style>\n\n<style>\n.linkerDialogsContent .md-dialog-container {\n  max-width: 100%;\n  max-height: 100%;\n}\n</style>","<template>\n   <!-- <div class=\"editorContainer\"> -->\n   <codemirror\n      v-model=\"codeObj.code\"\n      :options=\"cmOption\"\n   />\n   <!-- </div> -->\n\n</template>\n\n<script>\n// import dedent from \"dedent\";\nimport { codemirror } from \"vue-codemirror\";\n\n// language\nimport \"codemirror/mode/javascript/javascript\";\n\n// theme css\n// import \"codemirror/theme/monokai.css\";\n\n// require active-line\nimport \"codemirror/addon/selection/active-line\";\n\n// styleSelectedText\nimport \"codemirror/addon/selection/mark-selection\";\nimport \"codemirror/addon/search/searchcursor\";\n\n// hint\nimport \"codemirror/addon/hint/show-hint\";\n// import \"codemirror/addon/hint/show-hint.css\";\nimport \"codemirror/addon/hint/javascript-hint\";\nimport \"codemirror/addon/selection/active-line\";\n\n// highlightSelectionMatches\nimport \"codemirror/addon/scroll/annotatescrollbar\";\nimport \"codemirror/addon/search/matchesonscrollbar\";\nimport \"codemirror/addon/search/searchcursor\";\nimport \"codemirror/addon/search/match-highlighter\";\n\n// keyMap\nimport \"codemirror/mode/clike/clike\";\nimport \"codemirror/addon/edit/matchbrackets\";\nimport \"codemirror/addon/comment/comment\";\nimport \"codemirror/addon/dialog/dialog\";\n// import \"codemirror/addon/dialog/dialog.css\";\nimport \"codemirror/addon/search/searchcursor\";\nimport \"codemirror/addon/search/search\";\nimport \"codemirror/keymap/sublime\";\n\n// foldGutter\n// import \"codemirror/addon/fold/foldgutter.css\";\nimport \"codemirror/addon/fold/brace-fold\";\nimport \"codemirror/addon/fold/comment-fold\";\nimport \"codemirror/addon/fold/foldcode\";\nimport \"codemirror/addon/fold/foldgutter\";\nimport \"codemirror/addon/fold/indent-fold\";\nimport \"codemirror/addon/fold/markdown-fold\";\nimport \"codemirror/addon/fold/xml-fold\";\n\nexport default {\n   name: \"SpinalCodeMirror\",\n   components: {\n      codemirror,\n   },\n   props: {\n      codeObj: {},\n   },\n   data() {\n      return {\n         // code: this.codeObj.code,\n         cmOption: {\n            tabSize: 4,\n            styleActiveLine: true,\n            lineNumbers: true,\n            // styleSelectedText: false,\n            line: true,\n            // foldGutter: true,\n            lineWrapping: true,\n            gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n            // highlightSelectionMatches: {\n            //    showToken: /\\w/,\n            //    annotateScrollbar: true,\n            // },\n            mode: \"text/javascript\",\n            // hint.js options\n            hintOptions: {\n               completeSingle: false,\n            },\n            keyMap: \"sublime\",\n            matchBrackets: true,\n            showCursorWhenSelecting: true,\n            theme: \"monokai\",\n            extraKeys: { \"Ctrl-Space\": \"autocomplete\" },\n         },\n      };\n   },\n   mounted() {\n      // setTimeout(() => {\n      //    (this.styleSelectedText = true),\n      //       (this.cmOption.styleActiveLine = true);\n      // }, 1800);\n   },\n};\n</script>\n\n<style>\n.editorContainer {\n   width: 100%;\n   height: 100%;\n}\n\n.CodeMirror-focused .cm-matchhighlight {\n   background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFklEQVQI12NgYGBgkKzc8x9CMDAwAAAmhwSbidEoSQAAAABJRU5ErkJggg==);\n   background-position: bottom;\n   background-repeat: repeat-x;\n}\n.cm-matchhighlight {\n   background-color: lightgreen;\n}\n.CodeMirror-selection-highlight-scrollbar {\n   background-color: green;\n}\n\n/*\n////////////////////////////////////////////////////////////////////////\n//     codemirror/lib/codemirror.css\n//////////////////////////////////////////////////////////////////////// \n*/\n\n/* BASICS */\n\n.CodeMirror {\n   /* Set height, width, borders, and global font properties here */\n   font-family: monospace;\n   height: 300px;\n   color: black;\n   direction: ltr;\n}\n\n/* PADDING */\n\n.CodeMirror-lines {\n   padding: 4px 0; /* Vertical padding around content */\n}\n.CodeMirror pre.CodeMirror-line,\n.CodeMirror pre.CodeMirror-line-like {\n   padding: 0 4px; /* Horizontal padding of content */\n}\n\n.CodeMirror-scrollbar-filler,\n.CodeMirror-gutter-filler {\n   background-color: transparent; /* The little square between H and V scrollbars */\n}\n\n/* GUTTER */\n\n.CodeMirror-gutters {\n   border-right: 1px solid #ddd;\n   background-color: #f7f7f7;\n   white-space: nowrap;\n}\n.CodeMirror-linenumbers {\n}\n.CodeMirror-linenumber {\n   padding: 0 3px 0 5px;\n   min-width: 20px;\n   text-align: right;\n   color: #999;\n   white-space: nowrap;\n}\n\n.CodeMirror-guttermarker {\n   color: black;\n}\n.CodeMirror-guttermarker-subtle {\n   color: #999;\n}\n\n/* CURSOR */\n\n.CodeMirror-cursor {\n   border-left: 1px solid black;\n   border-right: none;\n   width: 0;\n}\n/* Shown when moving in bi-directional text */\n.CodeMirror div.CodeMirror-secondarycursor {\n   border-left: 1px solid silver;\n}\n.cm-fat-cursor .CodeMirror-cursor {\n   width: auto;\n   border: 0 !important;\n   background: #7e7;\n}\n.cm-fat-cursor div.CodeMirror-cursors {\n   z-index: 1;\n}\n.cm-fat-cursor-mark {\n   background-color: rgba(20, 255, 20, 0.5);\n   -webkit-animation: blink 1.06s steps(1) infinite;\n   -moz-animation: blink 1.06s steps(1) infinite;\n   animation: blink 1.06s steps(1) infinite;\n}\n.cm-animate-fat-cursor {\n   width: auto;\n   border: 0;\n   -webkit-animation: blink 1.06s steps(1) infinite;\n   -moz-animation: blink 1.06s steps(1) infinite;\n   animation: blink 1.06s steps(1) infinite;\n   background-color: #7e7;\n}\n@-moz-keyframes blink {\n   0% {\n   }\n   50% {\n      background-color: transparent;\n   }\n   100% {\n   }\n}\n@-webkit-keyframes blink {\n   0% {\n   }\n   50% {\n      background-color: transparent;\n   }\n   100% {\n   }\n}\n@keyframes blink {\n   0% {\n   }\n   50% {\n      background-color: transparent;\n   }\n   100% {\n   }\n}\n\n/* Can style cursor different in overwrite (non-insert) mode */\n.CodeMirror-overwrite .CodeMirror-cursor {\n}\n\n.cm-tab {\n   display: inline-block;\n   text-decoration: inherit;\n}\n\n.CodeMirror-rulers {\n   position: absolute;\n   left: 0;\n   right: 0;\n   top: -50px;\n   bottom: 0;\n   overflow: hidden;\n}\n.CodeMirror-ruler {\n   border-left: 1px solid #ccc;\n   top: 0;\n   bottom: 0;\n   position: absolute;\n}\n\n/* DEFAULT THEME */\n\n.cm-s-default .cm-header {\n   color: blue;\n}\n.cm-s-default .cm-quote {\n   color: #090;\n}\n.cm-negative {\n   color: #d44;\n}\n.cm-positive {\n   color: #292;\n}\n.cm-header,\n.cm-strong {\n   font-weight: bold;\n}\n.cm-em {\n   font-style: italic;\n}\n.cm-link {\n   text-decoration: underline;\n}\n.cm-strikethrough {\n   text-decoration: line-through;\n}\n\n.cm-s-default .cm-keyword {\n   color: #708;\n}\n.cm-s-default .cm-atom {\n   color: #219;\n}\n.cm-s-default .cm-number {\n   color: #164;\n}\n.cm-s-default .cm-def {\n   color: #00f;\n}\n.cm-s-default .cm-variable,\n.cm-s-default .cm-punctuation,\n.cm-s-default .cm-property,\n.cm-s-default .cm-operator {\n}\n.cm-s-default .cm-variable-2 {\n   color: #05a;\n}\n.cm-s-default .cm-variable-3,\n.cm-s-default .cm-type {\n   color: #085;\n}\n.cm-s-default .cm-comment {\n   color: #a50;\n}\n.cm-s-default .cm-string {\n   color: #a11;\n}\n.cm-s-default .cm-string-2 {\n   color: #f50;\n}\n.cm-s-default .cm-meta {\n   color: #555;\n}\n.cm-s-default .cm-qualifier {\n   color: #555;\n}\n.cm-s-default .cm-builtin {\n   color: #30a;\n}\n.cm-s-default .cm-bracket {\n   color: #997;\n}\n.cm-s-default .cm-tag {\n   color: #170;\n}\n.cm-s-default .cm-attribute {\n   color: #00c;\n}\n.cm-s-default .cm-hr {\n   color: #999;\n}\n.cm-s-default .cm-link {\n   color: #00c;\n}\n\n.cm-s-default .cm-error {\n   color: #f00;\n}\n.cm-invalidchar {\n   color: #f00;\n}\n\n.CodeMirror-composing {\n   border-bottom: 2px solid;\n}\n\n/* Default styles for common addons */\n\ndiv.CodeMirror span.CodeMirror-matchingbracket {\n   color: #0b0;\n}\ndiv.CodeMirror span.CodeMirror-nonmatchingbracket {\n   color: #a22;\n}\n.CodeMirror-matchingtag {\n   background: rgba(255, 150, 0, 0.3);\n}\n.CodeMirror-activeline-background {\n   background: #e8f2ff;\n}\n\n/* STOP */\n\n/* The rest of this file contains styles related to the mechanics of\n   the editor. You probably shouldn't touch them. */\n\n.CodeMirror {\n   position: relative;\n   overflow: hidden;\n   background: white;\n}\n\n.CodeMirror-scroll {\n   overflow: scroll !important; /* Things will break if this is overridden */\n   /* 50px is the magic margin used to hide the element's real scrollbars */\n   /* See overflow: hidden in .CodeMirror */\n   margin-bottom: -50px;\n   margin-right: -50px;\n   padding-bottom: 50px;\n   height: 100%;\n   outline: none; /* Prevent dragging from highlighting the element */\n   position: relative;\n}\n.CodeMirror-sizer {\n   position: relative;\n   border-right: 50px solid transparent;\n}\n\n/* The fake, visible scrollbars. Used to force redraw during scrolling\n   before actual scrolling happens, thus preventing shaking and\n   flickering artifacts. */\n.CodeMirror-vscrollbar,\n.CodeMirror-hscrollbar,\n.CodeMirror-scrollbar-filler,\n.CodeMirror-gutter-filler {\n   position: absolute;\n   z-index: 6;\n   display: none;\n   outline: none;\n}\n.CodeMirror-vscrollbar {\n   right: 0;\n   top: 0;\n   overflow-x: hidden;\n   overflow-y: scroll;\n}\n.CodeMirror-hscrollbar {\n   bottom: 0;\n   left: 0;\n   overflow-y: hidden;\n   overflow-x: scroll;\n}\n.CodeMirror-scrollbar-filler {\n   right: 0;\n   bottom: 0;\n}\n.CodeMirror-gutter-filler {\n   left: 0;\n   bottom: 0;\n}\n\n.CodeMirror-gutters {\n   position: absolute;\n   left: 0;\n   top: 0;\n   min-height: 100%;\n   z-index: 3;\n}\n.CodeMirror-gutter {\n   white-space: normal;\n   height: 100%;\n   display: inline-block;\n   vertical-align: top;\n   margin-bottom: -50px;\n}\n.CodeMirror-gutter-wrapper {\n   position: absolute;\n   z-index: 4;\n   background: none !important;\n   border: none !important;\n}\n.CodeMirror-gutter-background {\n   position: absolute;\n   top: 0;\n   bottom: 0;\n   z-index: 4;\n}\n.CodeMirror-gutter-elt {\n   position: absolute;\n   cursor: default;\n   z-index: 4;\n}\n.CodeMirror-gutter-wrapper ::selection {\n   background-color: transparent;\n}\n.CodeMirror-gutter-wrapper ::-moz-selection {\n   background-color: transparent;\n}\n\n.CodeMirror-lines {\n   cursor: text;\n   min-height: 1px; /* prevents collapsing before first draw */\n}\n.CodeMirror pre.CodeMirror-line,\n.CodeMirror pre.CodeMirror-line-like {\n   /* Reset some styles that the rest of the page might have set */\n   -moz-border-radius: 0;\n   -webkit-border-radius: 0;\n   border-radius: 0;\n   border-width: 0;\n   background: transparent;\n   font-family: inherit;\n   font-size: inherit;\n   margin: 0;\n   white-space: pre;\n   word-wrap: normal;\n   line-height: inherit;\n   color: inherit;\n   z-index: 2;\n   position: relative;\n   overflow: visible;\n   -webkit-tap-highlight-color: transparent;\n   -webkit-font-variant-ligatures: contextual;\n   font-variant-ligatures: contextual;\n}\n.CodeMirror-wrap pre.CodeMirror-line,\n.CodeMirror-wrap pre.CodeMirror-line-like {\n   word-wrap: break-word;\n   white-space: pre-wrap;\n   word-break: normal;\n}\n\n.CodeMirror-linebackground {\n   position: absolute;\n   left: 0;\n   right: 0;\n   top: 0;\n   bottom: 0;\n   z-index: 0;\n}\n\n.CodeMirror-linewidget {\n   position: relative;\n   z-index: 2;\n   padding: 0.1px; /* Force widget margins to stay inside of the container */\n}\n\n.CodeMirror-widget {\n}\n\n.CodeMirror-rtl pre {\n   direction: rtl;\n}\n\n.CodeMirror-code {\n   outline: none;\n}\n\n/* Force content-box sizing for the elements where we expect it */\n.CodeMirror-scroll,\n.CodeMirror-sizer,\n.CodeMirror-gutter,\n.CodeMirror-gutters,\n.CodeMirror-linenumber {\n   -moz-box-sizing: content-box;\n   box-sizing: content-box;\n}\n\n.CodeMirror-measure {\n   position: absolute;\n   width: 100%;\n   height: 0;\n   overflow: hidden;\n   visibility: hidden;\n}\n\n.CodeMirror-cursor {\n   position: absolute;\n   pointer-events: none;\n}\n.CodeMirror-measure pre {\n   position: static;\n}\n\ndiv.CodeMirror-cursors {\n   visibility: hidden;\n   position: relative;\n   z-index: 3;\n}\ndiv.CodeMirror-dragcursors {\n   visibility: visible;\n}\n\n.CodeMirror-focused div.CodeMirror-cursors {\n   visibility: visible;\n}\n\n.CodeMirror-selected {\n   background: #d9d9d9;\n}\n.CodeMirror-focused .CodeMirror-selected {\n   background: #d7d4f0;\n}\n.CodeMirror-crosshair {\n   cursor: crosshair;\n}\n.CodeMirror-line::selection,\n.CodeMirror-line > span::selection,\n.CodeMirror-line > span > span::selection {\n   background: #d7d4f0;\n}\n.CodeMirror-line::-moz-selection,\n.CodeMirror-line > span::-moz-selection,\n.CodeMirror-line > span > span::-moz-selection {\n   background: #d7d4f0;\n}\n\n.cm-searching {\n   background-color: #ffa;\n   background-color: rgba(255, 255, 0, 0.4);\n}\n\n/* Used to force a border model for a node */\n.cm-force-border {\n   padding-right: 0.1px;\n}\n\n@media print {\n   /* Hide the cursor when printing */\n   .CodeMirror div.CodeMirror-cursors {\n      visibility: hidden;\n   }\n}\n\n/* See issue #2901 */\n.cm-tab-wrap-hack:after {\n   content: \"\";\n}\n\n/* Help users use markselection to safely style text background */\nspan.CodeMirror-selectedtext {\n   background: none;\n}\n\n/*\n////////////////////////////////////////////////////////////////////////\n//     Based on Sublime Text's Monokai theme\n//////////////////////////////////////////////////////////////////////// \n*/\n\n.cm-s-monokai.CodeMirror {\n   background: #272822;\n   color: #f8f8f2;\n}\n.cm-s-monokai div.CodeMirror-selected {\n   background: #49483e;\n}\n.cm-s-monokai .CodeMirror-line::selection,\n.cm-s-monokai .CodeMirror-line > span::selection,\n.cm-s-monokai .CodeMirror-line > span > span::selection {\n   background: rgba(73, 72, 62, 0.99);\n}\n.cm-s-monokai .CodeMirror-line::-moz-selection,\n.cm-s-monokai .CodeMirror-line > span::-moz-selection,\n.cm-s-monokai .CodeMirror-line > span > span::-moz-selection {\n   background: rgba(73, 72, 62, 0.99);\n}\n.cm-s-monokai .CodeMirror-gutters {\n   background: #272822;\n   border-right: 0px;\n}\n.cm-s-monokai .CodeMirror-guttermarker {\n   color: white;\n}\n.cm-s-monokai .CodeMirror-guttermarker-subtle {\n   color: #d0d0d0;\n}\n.cm-s-monokai .CodeMirror-linenumber {\n   color: #d0d0d0;\n}\n.cm-s-monokai .CodeMirror-cursor {\n   border-left: 1px solid #f8f8f0;\n}\n\n.cm-s-monokai span.cm-comment {\n   color: #75715e;\n}\n.cm-s-monokai span.cm-atom {\n   color: #ae81ff;\n}\n.cm-s-monokai span.cm-number {\n   color: #ae81ff;\n}\n\n.cm-s-monokai span.cm-comment.cm-attribute {\n   color: #97b757;\n}\n.cm-s-monokai span.cm-comment.cm-def {\n   color: #bc9262;\n}\n.cm-s-monokai span.cm-comment.cm-tag {\n   color: #bc6283;\n}\n.cm-s-monokai span.cm-comment.cm-type {\n   color: #5998a6;\n}\n\n.cm-s-monokai span.cm-property,\n.cm-s-monokai span.cm-attribute {\n   color: #a6e22e;\n}\n.cm-s-monokai span.cm-keyword {\n   color: #f92672;\n}\n.cm-s-monokai span.cm-builtin {\n   color: #66d9ef;\n}\n.cm-s-monokai span.cm-string {\n   color: #e6db74;\n}\n\n.cm-s-monokai span.cm-variable {\n   color: #f8f8f2;\n}\n.cm-s-monokai span.cm-variable-2 {\n   color: #9effff;\n}\n.cm-s-monokai span.cm-variable-3,\n.cm-s-monokai span.cm-type {\n   color: #66d9ef;\n}\n.cm-s-monokai span.cm-def {\n   color: #fd971f;\n}\n.cm-s-monokai span.cm-bracket {\n   color: #f8f8f2;\n}\n.cm-s-monokai span.cm-tag {\n   color: #f92672;\n}\n.cm-s-monokai span.cm-header {\n   color: #ae81ff;\n}\n.cm-s-monokai span.cm-link {\n   color: #ae81ff;\n}\n.cm-s-monokai span.cm-error {\n   background: #f92672;\n   color: #f8f8f0;\n}\n\n.cm-s-monokai .CodeMirror-activeline-background {\n   background: #373831;\n}\n.cm-s-monokai .CodeMirror-matchingbracket {\n   text-decoration: underline;\n   color: white !important;\n}\n\n/*\n////////////////////////////////////////////////////////////////////////\n//     Show hint\n//////////////////////////////////////////////////////////////////////// \n\n*/\n\n.CodeMirror-hints {\n   position: absolute;\n   z-index: 10;\n   overflow: hidden;\n   list-style: none;\n\n   margin: 0;\n   padding: 2px;\n\n   -webkit-box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.2);\n   -moz-box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.2);\n   box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.2);\n   border-radius: 3px;\n   border: 1px solid silver;\n\n   background: white;\n   font-size: 90%;\n   font-family: monospace;\n\n   max-height: 20em;\n   overflow-y: auto;\n}\n\n.CodeMirror-hint {\n   margin: 0;\n   padding: 0 4px;\n   border-radius: 2px;\n   white-space: pre;\n   color: black;\n   cursor: pointer;\n}\n\nli.CodeMirror-hint-active {\n   background: #08f;\n   color: white;\n}\n\n/*\n\n////////////////////////////////////////////////////////////////////////\n//     import \"codemirror/addon/dialog/dialog.css\n//////////////////////////////////////////////////////////////////////// \n\n*/\n\n.CodeMirror-dialog {\n   position: absolute;\n   left: 0;\n   right: 0;\n   background: inherit;\n   z-index: 15;\n   padding: 0.1em 0.8em;\n   overflow: hidden;\n   color: inherit;\n}\n\n.CodeMirror-dialog-top {\n   border-bottom: 1px solid #eee;\n   top: 0;\n}\n\n.CodeMirror-dialog-bottom {\n   border-top: 1px solid #eee;\n   bottom: 0;\n}\n\n.CodeMirror-dialog input {\n   border: none;\n   outline: none;\n   background: transparent;\n   width: 20em;\n   color: inherit;\n   font-family: monospace;\n}\n\n.CodeMirror-dialog button {\n   font-size: 70%;\n}\n\n/*\n\n////////////////////////////////////////////////////////////////////////\n//     import \"codemirror/addon/fold/foldgutter.css\"\n//////////////////////////////////////////////////////////////////////// \n\n*/\n.CodeMirror-foldmarker {\n   color: blue;\n   text-shadow: #b9f 1px 1px 2px, #b9f -1px -1px 2px, #b9f 1px -1px 2px,\n      #b9f -1px 1px 2px;\n   font-family: arial;\n   line-height: 0.3;\n   cursor: pointer;\n}\n.CodeMirror-foldgutter {\n   width: 0.7em;\n}\n.CodeMirror-foldgutter-open,\n.CodeMirror-foldgutter-folded {\n   cursor: pointer;\n}\n.CodeMirror-foldgutter-open:after {\n   content: \"\\25BE\";\n}\n.CodeMirror-foldgutter-folded:after {\n   content: \"\\25B8\";\n}\n</style>","<template>\n   <md-dialog\n      :md-active.sync=\"showDialog\"\n      @md-closed=\"closeDialog(false)\"\n      class=\"personalizedDialog\"\n   >\n\n      <md-dialog-title class=\"personalizedDialogTitle\">Personnalize attribute</md-dialog-title>\n      <md-dialog-content class=\"personalizedDialogContent\">\n         <div class=\"radios\">\n            <div class=\"radio\">\n               <md-radio\n                  class=\"md-primary\"\n                  v-model=\"useRegex\"\n                  :value=\"true\"\n               >Use regex</md-radio>\n            </div>\n\n            <div class=\"radio\">\n               <div class=\"radio\">\n                  <md-radio\n                     class=\"md-primary\"\n                     v-model=\"useRegex\"\n                     :value=\"false\"\n                  >Use Function</md-radio>\n               </div>\n            </div>\n         </div>\n\n         <div v-if=\"useRegex\">\n            <div>\n               <!-- <div class=\"md-layout-item md-size-50\"><span class=\"md-caption\">use <b>{{`'${PCL_ATTR}'`}}</b> to represente PLC attribute value</span></div>\n               <div class=\"md-layout-item md-size-50\"><span class=\"md-caption\">use <b>{{`'${OBJECT_ATTR}'`}}</b> to represente PLC attribute value</span></div> -->\n               <div>\n                  <md-subheader class=\"md-primary\">use {{` '${PCL_ATTR}' `}} to represente PLC attribute value</md-subheader>\n               </div>\n\n               <div>\n                  <md-subheader class=\"md-primary\">use {{` '${OBJECT_ATTR}' `}} to represente Object controlled attribute value</md-subheader>\n               </div>\n            </div>\n\n            <md-list class=\"regex _content\">\n               <!-- <md-list-item class=\"radio\">\n\n            </md-list-item> -->\n\n               <!-- <md-list-item>\n               \n            </md-list-item> -->\n\n               <md-list-item>\n                  <div class=\"md-layout-item md-size-35\">\n                     <md-field>\n                        <label></label>\n                        <md-select\n                           id=\"vertical\"\n                           v-model=\"regexValue.select\"\n                        >\n                           <md-option :value=\"PCL_ATTR\">PCL Attribute Value</md-option>\n                           <md-option :value=\"OBJECT_ATTR\">Object controlled Attribute Value</md-option>\n                        </md-select>\n                     </md-field>\n                  </div>\n\n                  <div\n                     class=\"md-layout-item md-size-20\"\n                     style=\"text-align : center\"\n                  >\n                     must match with\n                  </div>\n\n                  <div class=\"md-layout-item md-size-35\">\n                     <md-field>\n                        <md-icon :md-src=\"slashIcon\"></md-icon>\n                        <label>Your regex</label>\n                        <md-input\n                           :disabled=\"!useRegex\"\n                           v-model=\"regexValue.text\"\n                        ></md-input>\n                        <md-icon :md-src=\"slashIcon\"></md-icon>\n                     </md-field>\n                  </div>\n\n               </md-list-item>\n\n               <md-list-item>\n                  <md-field class=\"_mdField\">\n                     <label>Flags</label>\n\n                     <md-select\n                        :disabled=\"!useRegex\"\n                        v-model=\"regexValue.flags\"\n                        name=\"flags\"\n                        id=\"flags\"\n                        md-dense\n                        multiple\n                     >\n\n                        <md-option\n                           v-for=\"(flag,index) in flagsList\"\n                           :key=\"index\"\n                           :value=\"flag.value\"\n                        >{{flag.name}}</md-option>\n\n                     </md-select>\n\n                  </md-field>\n               </md-list-item>\n\n            </md-list>\n         </div>\n\n         <div\n            class=\"function _content\"\n            v-else\n         >\n\n            <spinal-code-mirror\n               class=\"editorContainer\"\n               :codeObj=\"functionValue\"\n            ></spinal-code-mirror>\n\n         </div>\n\n      </md-dialog-content>\n\n      <md-dialog-actions>\n         <md-button\n            class=\"md-primary\"\n            @click=\"closeDialog(false)\"\n         >Close</md-button>\n         <md-button\n            class=\"md-primary\"\n            @click=\"closeDialog(true)\"\n         >Save</md-button>\n      </md-dialog-actions>\n   </md-dialog>\n</template>\n\n<script>\n// import { PLC_ATTR, OBJECT_ATTR } from \"../../../js/attributeConfig\";\nimport { CONSTANTS } from \"spinal-env-viewer-plugin-network-tree-service\";\n\nimport flagsList from \"../../../js/flags\";\nimport SpinalCodeMirror from \"../../components/code-mirror/SpinalCodeMirror.vue\";\nimport functionText from \"../../../js/personalized_functions/function\";\n\nconst slashIcon = require(\"../../../assets/slash.svg\");\n\nexport default {\n   name: \"personalizedAttributeDialog\",\n   props: [\"onFinised\"],\n   components: { \"spinal-code-mirror\": SpinalCodeMirror },\n   data() {\n      this.callback;\n      this.flagsList = flagsList;\n      this.PCL_ATTR = CONSTANTS.PLC_ATTR;\n      this.OBJECT_ATTR = CONSTANTS.OBJECT_ATTR;\n\n      this.slashIcon = slashIcon;\n\n      return {\n         useRegex: true,\n         showDialog: true,\n         regexValue: {\n            select: this.OBJECT_ATTR,\n            text: \"\",\n            flags: [],\n         },\n         functionValue: {\n            code: functionText,\n         },\n      };\n   },\n\n   methods: {\n      opened(option) {\n         if (option.isPersonalized) {\n            this.useRegex = option.attribute.isRegex;\n            if (this.useRegex) {\n               this.regexValue.text = option.attribute.text;\n               this.regexValue.flags = option.attribute.flags;\n               this.regexValue.select = option.attribute.select;\n            } else {\n               this.functionValue.code = option.attribute.callback;\n            }\n         }\n\n         this.callback = option.callback;\n      },\n\n      removed(option) {\n         if (option.closeResult) {\n            if (typeof this.callback === \"function\") {\n               if (this.useRegex) this.callback(this.useRegex, this.regexValue);\n               else this.callback(this.useRegex, this.functionValue);\n            }\n         }\n         this.showDialog = false;\n      },\n      closeDialog(closeResult) {\n         if (typeof this.onFinised === \"function\") {\n            this.onFinised({ closeResult });\n         }\n      },\n   },\n};\n</script>\n\n<style scoped>\n.personalizedDialog {\n   width: 1000px;\n   height: 500px;\n}\n\n.personalizedDialog .personalizedDialogTitle {\n   text-align: center;\n}\n\n.personalizedDialog .personalizedDialogContent {\n   width: 100%;\n   height: 100%;\n   /* display: flex;\n   justify-content: space-between; */\n}\n\n.personalizedDialog .personalizedDialogContent .radios {\n   width: 100%;\n   height: 50px;\n   display: flex;\n}\n\n.personalizedDialog .personalizedDialogContent ._content {\n   width: 100%;\n   height: calc(100% - 50px);\n}\n\n/* \n.personalizedDialog .personalizedDialogContent .regex {\n   width: 50%;\n   height: 100%;\n   border-right: 1px solid grey;\n\n}\n\n.personalizedDialog .personalizedDialogContent .function {\n   width: 49%;\n   height: 100%;\n\n}\n\n.personalizedDialog .personalizedDialogContent .function .radio {\n   width: 100%;\n   height: 50px;\n}\n\n.personalizedDialog .personalizedDialogContent .function .content {\n   max-width: 100%;\n   height: calc(100% - 50px);\n   overflow: auto;\n} */\n</style>\n\n<style>\n.personalizedDialog .md-dialog-container {\n   max-width: 100%;\n   max-height: 100%;\n}\n</style>","<template>\n   <md-dialog\n      :md-active.sync=\"showDialog\"\n      @md-closed=\"closeDialog(false)\"\n      class=\"personalizedDialog\"\n   >\n      <md-dialog-title class=\"personalizedDialogTitle\">Personnalize Naming convention</md-dialog-title>\n\n      <md-dialog-content class=\"personalizedDialogContent\">\n         <div class=\"function _content\">\n\n            <spinal-code-mirror\n               class=\"editorContainer\"\n               :codeObj=\"functionValue\"\n            ></spinal-code-mirror>\n\n         </div>\n\n      </md-dialog-content>\n\n      <md-dialog-actions>\n         <md-button\n            class=\"md-primary\"\n            @click=\"closeDialog(false)\"\n         >Close</md-button>\n         <md-button\n            class=\"md-primary\"\n            @click=\"closeDialog(true)\"\n         >Save</md-button>\n      </md-dialog-actions>\n   </md-dialog>\n</template>\n\n\n<script>\nimport SpinalCodeMirror from \"../../components/code-mirror/SpinalCodeMirror.vue\";\nimport functionText from \"../../../js/personalized_functions/naming_convention_function\";\n\nexport default {\n   name: \"PersonalizeNamingConvention\",\n   props: [\"onFinised\"],\n   components: { \"spinal-code-mirror\": SpinalCodeMirror },\n   data() {\n      this.callback;\n\n      return {\n         showDialog: true,\n         functionValue: {\n            code: functionText,\n         },\n      };\n   },\n   methods: {\n      opened(option) {\n         if (!option.config.useAttrValue) {\n            this.functionValue.code = option.config.personalized.callback;\n         }\n\n         this.callback = option.callback;\n      },\n\n      removed(option) {\n         if (option.closeResult) {\n            if (typeof this.callback === \"function\") {\n               this.callback(this.functionValue.code);\n            }\n         }\n         this.showDialog = false;\n      },\n\n      closeDialog(closeResult) {\n         if (typeof this.onFinised === \"function\") {\n            this.onFinised({ closeResult });\n         }\n      },\n   },\n};\n</script>\n\n<style scoped>\n.personalizedDialog {\n   width: 1000px;\n   height: 500px;\n}\n\n.personalizedDialog .personalizedDialogTitle {\n   text-align: center;\n}\n\n.personalizedDialog .personalizedDialogContent {\n   width: 100%;\n   height: 100%;\n   /* display: flex;\n   justify-content: space-between; */\n}\n\n.personalizedDialog .personalizedDialogContent ._content {\n   width: 100%;\n   height: calc(100% - 50px);\n}\n</style>\n\n<style>\n.personalizedDialog .md-dialog-container {\n   max-width: 100%;\n   max-height: 100%;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n   <div class=\"linkerDialogsContent\">\n\n      <!-- <div class=\"content\"> -->\n      <edit-link\n         :data=\"data\"\n         :rightTitle=\"'BMS devices'\"\n         :leftTitle=\"'BIM devices'\"\n      ></edit-link>\n      <!-- </div> -->\n\n   </div>\n</template>\n\n<script>\nimport editLinkContent from \"../../components/links/editLinks.vue\";\n\nexport default {\n   name: \"editLinkToGTBDevice\",\n   props: { data: {} },\n   components: {\n      \"edit-link\": editLinkContent,\n   },\n   data() {\n      return {};\n   },\n   mounted() {\n      // console.log(\"mounted\");\n      // this.data = this._getResult(option.bmsDevices, option.bimDevices);\n   },\n   methods: {\n      // opened(option) {},\n      // removed(option) {\n      //    this.showDialog = false;\n      // },\n      // closeDialog(closeResult) {\n      //    if (typeof this.onFinised === \"function\") {\n      //       this.onFinised(closeResult);\n      //    }\n      // },\n   },\n};\n</script>\n\n<style scoped>\n.linkerDialogsContent {\n   width: 100%;\n   height: 100%;\n}\n\n/* .linkerDialogsContent .content {\n   width: 100%;\n   height: 100%;\n} */\n</style>","<!--\nCopyright 2022 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <div class=\"config_content\">\n    <div class=\"useThese\">\n      <md-checkbox class=\"md-primary\"\n                   v-model=\"properties.useTheseAttributes\">\n        Use also these configurations to link subItems</md-checkbox>\n    </div>\n\n    <div class=\"_container\">\n      <div class=\"subcontent\">\n        <div class=\"title\">BMS Attribute</div>\n        <div class=\"content\">\n          <div class=\"div_select\">\n            <!-- <md-field>\n              <label for=\"property\">BMS property</label>\n              <md-select v-model=\"bmsData.property\"\n                         name=\"Bms Property\"\n                         id=\"property\"\n                         placeholder=\"Bms Property\">\n                <md-option v-for=\"property in bmsProperties\"\n                           :value=\"property.value\"\n                           :key=\"property.value\">{{property.name}}</md-option>\n              </md-select>\n            </md-field> -->\n            <md-field>\n              <label>BMS Property</label>\n              <md-input v-model=\"bmsData.property\"></md-input>\n            </md-field>\n          </div>\n\n          <div class=\"div_code\">\n            <div class=\"checkbox_div\">\n              <md-checkbox class=\"md-primary\"\n                           v-model=\"bmsData.useFunction\">Use function to format\n                value</md-checkbox>\n            </div>\n\n            <div class=\"text_editor\"\n                 v-if=\"bmsData.useFunction\">\n              <spinal-code-mirror class=\"editorContainer\"\n                                  :codeObj=\"bmsData.callback\">\n              </spinal-code-mirror>\n            </div>\n          </div>\n\n        </div>\n      </div>\n      <div class=\"subcontent\">\n        <div class=\"title\">BIM Attribute</div>\n        <div class=\"content\">\n          <div class=\"div_select\">\n            <md-field>\n              <label>BIM Property</label>\n              <md-input v-model=\"bimData.property\"></md-input>\n            </md-field>\n          </div>\n\n          <div class=\"div_code\">\n            <div class=\"checkbox_div\">\n              <md-checkbox class=\"md-primary\"\n                           v-model=\"bimData.useFunction\">Use function to format\n                value</md-checkbox>\n            </div>\n\n            <div class=\"text_editor\"\n                 v-if=\"bimData.useFunction\">\n              <spinal-code-mirror class=\"editorContainer\"\n                                  :codeObj=\"bimData.callback\">\n              </spinal-code-mirror>\n            </div>\n\n          </div>\n\n        </div>\n      </div>\n    </div>\n  </div>\n\n</template>\n\n<script>\nimport { SpinalBmsDevice } from \"spinal-model-bmsnetwork\";\nimport SpinalCodeMirror from \"../../components/code-mirror/SpinalCodeMirror.vue\";\n\nexport default {\n  name: \"configurationTemplate\",\n  props: {\n    bimData: {},\n    bmsData: {},\n    properties: {},\n  },\n  components: { \"spinal-code-mirror\": SpinalCodeMirror },\n  data() {\n    return {\n      bmsProperties: [],\n    };\n  },\n  mounted() {\n    this.bmsProperties = this.getBmsProperties();\n  },\n  methods: {\n    getBmsProperties() {\n      // const device = new SpinalBmsDevice();\n      // return device._attribute_names.map((element) => ({\n      //    name: element,\n      //    value: element,\n      // }));\n      return [\n        {\n          name: \"Device ID\",\n          value: \"id\",\n        },\n        {\n          name: \"Device Name\",\n          value: \"name\",\n        },\n        {\n          name: \"IP address\",\n          value: \"address\",\n        },\n        {\n          name: \"Mac address\",\n          value: \"hostId\",\n        },\n      ];\n    },\n  },\n};\n</script>\n\n\n<style scoped>\n.config_content {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.config_content .useThese {\n  width: 100%;\n  height: 9%;\n  display: flex;\n  align-items: center;\n  font-size: 1.3em;\n}\n\n.config_content ._container {\n  width: 100%;\n  height: 90%;\n  display: flex;\n  justify-content: space-between;\n}\n\n.config_content ._container .subcontent {\n  width: 49%;\n  height: 100%;\n  border: 1px solid #ffffff;\n  border-radius: 5%;\n}\n\n.config_content ._container .subcontent .title {\n  width: 100%;\n  height: 50px;\n  border-bottom: 1px solid white;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.config_content ._container .subcontent .content {\n  height: calc(100% - 50px);\n  padding: 0 7px;\n}\n\n.config_content ._container .subcontent .content .div_select {\n  width: 100%;\n  height: 50px;\n}\n\n.config_content ._container .subcontent .content .div_code {\n  width: 100%;\n  height: calc(100% - 60px);\n}\n\n.config_content ._container .subcontent .content .div_code .checkbox_div {\n  width: 100%;\n  height: 50px;\n}\n\n.config_content ._container .subcontent .content .div_code .text_editor {\n  width: 100%;\n  height: calc(100% - 50px);\n}\n</style>\n\n<style>\n.config_content\n  ._container\n  .subcontent\n  .content\n  .div_code\n  .text_editor\n  .CodeMirror.cm-s-monokai.CodeMirror-wrap {\n  width: 100%;\n  height: 98%;\n}\n</style>","<!--\nCopyright 2021 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n  <md-dialog class=\"mdDialogContainer\"\n             :md-active.sync=\"showDialog\"\n             @md-closed=\"closeDialog(false)\">\n    <md-dialog-title class=\"dialogTitle\">{{title}}</md-dialog-title>\n\n    <md-dialog-content class=\"content\">\n      <link-component v-if=\"pageSelected === PAGES.selection\"\n                      :context_title=\"'Contexts'\"\n                      :category_title=\"'Subnetworks'\"\n                      :group_title=\"'Bms devices'\"\n                      :data=\"data\"\n                      :profils=\"networks\"\n                      :devices=\"devices\"\n                      :contextSelected=\"contextSelected\"\n                      :profilSelected=\"networkSelected\"\n                      :deviceSelected=\"deviceSelected\"\n                      :isAutomate=\"isAutomate\"\n                      @selectContext=\"selectContext\"\n                      @selectProfil=\"selectNetwork\"\n                      @selectDevice=\"selectDevice\"></link-component>\n\n      <configuration-template v-else-if=\"pageSelected === PAGES.configuration\"\n                              :properties=\"configuration\"\n                              :bimData=\"configuration.bimData\"\n                              :bmsData=\"configuration.bmsData\">\n      </configuration-template>\n\n      <confirm-link v-else-if=\"pageSelected === PAGES.result\"\n                    :data=\"result\"></confirm-link>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.loading\">\n        <md-progress-spinner md-mode=\"indeterminate\"></md-progress-spinner>\n      </div>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.error\">\n        <md-icon class=\"md-size-5x\">error_outline</md-icon>\n      </div>\n\n      <div class=\"state\"\n           v-else-if=\"pageSelected === PAGES.success\">\n        <md-icon class=\"md-size-5x\">done</md-icon>\n      </div>\n\n      <div class=\"progress-bar\"\n           v-else-if=\"pageSelected === PAGES.creation\">\n        <div class=\"percent-number\">{{percent}} %</div>\n        <md-progress-bar class=\"percent-bar\"\n                         md-mode=\"buffer\"\n                         :md-value=\"percent\"></md-progress-bar>\n      </div>\n\n    </md-dialog-content>\n\n    <md-dialog-actions>\n      <md-button class=\"md-primary\"\n                 @click=\"closeDialog(false)\">Close</md-button>\n\n      <md-button class=\"md-primary\"\n                 :disabled=\"disabledPreviousButton()\"\n                 @click=\"goToPrevious\">Previous</md-button>\n\n      <md-button class=\"md-primary\"\n                 :disabled=\"disabledNextButton()\"\n                 @click=\"goToNext\">Next</md-button>\n\n      <md-button :disabled=\"disabledLinkButton()\"\n                 class=\"md-primary\"\n                 @click=\"createLink\">Link</md-button>\n    </md-dialog-actions>\n\n  </md-dialog>\n\n</template>\n\n<script>\nimport linkBimToBmsControllers from \"../../../js/controllers/links/linkBimToBmsControllers\";\n// import linkAutomateToBmsDeviceUtilities from \"../../../js/link_utilities/linkAutomateToBmsDevice\";\n\nimport {\n  AttributesUtilities,\n  LinkBmsDeviceService,\n} from \"spinal-env-viewer-plugin-network-tree-service\";\n\nimport networkService from \"../../../js/network/networkService\";\n\nimport LinkComponent from \"../../components/links/LinkComponent.vue\";\nimport ConfirmLinkToGTB from \"./confirmLinkToGTB.vue\";\nimport ConfigurationTemplate from \"../../components/links/configuration.vue\";\n\nimport bmsDataFunction from \"../../../js/personalized_functions/replace_by\";\nimport bimDataFunction from \"../../../js/personalized_functions/replace-by\";\n// import { SpinalForgeViewer } from \"spinal-env-viewer-plugin-forge\";\n\nconst lodash = require(\"lodash\");\n\nexport default {\n  name: \"linkToGtbDialog\",\n  components: {\n    \"link-component\": LinkComponent,\n    \"confirm-link\": ConfirmLinkToGTB,\n    \"configuration-template\": ConfigurationTemplate,\n  },\n  props: [\"onFinised\"],\n  data() {\n    this.PAGES = {\n      selection: 0,\n      configuration: 1,\n      result: 2,\n      creation: 3,\n      loading: 4,\n      success: 5,\n      error: 6,\n    };\n\n    this.bimDevices = [];\n\n    this.contextId;\n    this.nodeId;\n    this.callback = undefined;\n\n    return {\n      configuration: {\n        bimData: {\n          property: \"CFA_Repre d'quipement\",\n          useFunction: false,\n          callback: { code: bimDataFunction },\n        },\n        bmsData: {\n          property: \"name\",\n          useFunction: false,\n          callback: { code: bmsDataFunction },\n        },\n\n        useTheseAttributes: false,\n      },\n\n      percent: 0,\n      title: \"\",\n      result: undefined,\n      showDialog: true,\n      pageSelected: this.PAGES.selection,\n      isAutomate: false,\n\n      data: [],\n      networks: [],\n      devices: [],\n\n      contextSelected: undefined,\n      networkSelected: undefined,\n      deviceSelected: undefined,\n    };\n  },\n  methods: {\n    opened(option) {\n      this.pageSelected = this.PAGES.loading;\n\n      this.contextId = option.contextId;\n      this.nodeId = option.nodeId;\n      this.isAutomate = option.isAutomate;\n\n      this.loadData()\n        .then((result) => {\n          this.updateNetworks();\n          this.title = \"Select context, subnetwork or the bms device\";\n          this.pageSelected = this.PAGES.selection;\n        })\n        .catch((err) => {\n          console.error(err);\n          this.pageSelected = this.PAGES.error;\n        });\n\n      // this.getDeviceContextTreeStructure()\n      //   .then(async () => {\n      //     this.title = \"Select context, subnetwork or the bms device\";\n      //     this.bimDevices = await this._getAutomates(\n      //       this.nodeId,\n      //       this.contextId,\n      //       this.isAutomate\n      //     );\n      //     this.pageSelected = this.PAGES.selection;\n      //   })\n      //   .catch((err) => {\n      //     this.pageSelected = this.PAGES.error;\n      //   });\n    },\n\n    removed(save) {\n      if (save) {\n      }\n      this.showDialog = false;\n    },\n\n    closeDialog(closeResult) {\n      if (typeof this.onFinised === \"function\") {\n        this.onFinised(closeResult);\n      }\n    },\n\n    async createLink() {\n      this.pageSelected = this.PAGES.creation;\n\n      return (() => {\n        if (!this.configuration.useTheseAttributes)\n          return this._useProfileToLink();\n        return this._useAttributeToLink();\n      })()\n        .then(() => {\n          this.pageSelected = this.PAGES.success;\n        })\n        .catch((err) => {\n          console.error(err);\n          this.pageSelected = this.PAGES.error;\n        });\n    },\n\n    _useProfileToLink() {\n      return linkBimToBmsControllers.createLinkBetweenBimAndBms(\n        this.contextSelected,\n        this.result.valids,\n        this.percent\n      );\n    },\n\n    _useAttributeToLink() {\n      return linkBimToBmsControllers.createLinkBetweenBimAndBmsUsingAttribute(\n        this.contextSelected,\n        this.result.valids,\n        this.percent\n      );\n    },\n\n    loadData() {\n      const bmsTreeProm =\n        linkBimToBmsControllers.getBmsDevicesContextTreeStructure();\n      const automateBimsProm = linkBimToBmsControllers.getAutomateBims(\n        this.nodeId,\n        this.contextId\n      );\n      return Promise.all([bmsTreeProm, automateBimsProm]).then(\n        ([data, automatesBims]) => {\n          this.data = data;\n          this.bimDevices = automatesBims;\n        }\n      );\n    },\n\n    goToNext() {\n      const currentPage = this.pageSelected;\n      this.pageSelected = this.PAGES.loading;\n\n      switch (currentPage) {\n        case this.PAGES.selection:\n          this._goToConfiguration();\n          break;\n        case this.PAGES.configuration:\n          this._getResult().catch((error) => {\n            console.error(error);\n            this.pageSelected = this.PAGES.error;\n          });\n          break;\n\n        default:\n          break;\n      }\n    },\n\n    goToPrevious() {\n      const currentPage = this.pageSelected;\n      this.pageSelected = this.PAGES.loading;\n\n      switch (currentPage) {\n        case this.PAGES.result:\n          this.pageSelected = this.PAGES.configuration;\n          break;\n        case this.PAGES.configuration:\n          this.pageSelected = this.PAGES.selection;\n          break;\n\n        default:\n          break;\n      }\n    },\n\n    _goToConfiguration() {\n      this.title = \"Configuration\";\n      this.pageSelected = this.PAGES.configuration;\n    },\n\n    async _getResult() {\n      this.title = \"Edit Link\";\n\n      // const bmsDevices = await this._getBmsDevicesProperties(\n      //   this.configuration.bmsData.property\n      // );\n\n      // const bimDevices = await this.getElementProperties(\n      //   this.bimDevices,\n      //   this.configuration.bimData.property\n      // );\n\n      const bmsAttributeName = this.configuration.bmsData.property;\n      const bimAttributeName = this.configuration.bimData.property;\n      const listObj = {\n        devices: this.devices,\n        networks: this.networks,\n        tree: this.data,\n      };\n\n      linkBimToBmsControllers\n        .getLinkResultBetweenBimAndBms(\n          bmsAttributeName,\n          this.contextSelected,\n          this.networkSelected,\n          this.deviceSelected,\n          listObj,\n          this.bimDevices,\n          bimAttributeName,\n          this.configuration\n        )\n        .then((res) => {\n          this.pageSelected = this.PAGES.result;\n          this.result = res;\n        })\n        .catch((err) => {\n          console.error(err);\n          this.pageSelected = this.PAGES.err;\n        });\n    },\n\n    // _getBmsDevicesProperties(attributeName) {\n    //   const devices = this._getBmsDevices();\n    //   return linkBimToBmsControllers._getBmsDevicesProperties(\n    //     attributeName,\n    //     devices\n    //   );\n    // },\n\n    // _getBmsDevices() {\n    //   if (typeof this.deviceSelected !== \"undefined\") {\n    //     return this.devices.filter((el) => el.id === this.deviceSelected);\n    //   } else if (typeof this.networkSelected !== \"undefined\") {\n    //     const found = this.networks.find(\n    //       (el) => el.id === this.networkSelected\n    //     );\n    //     return found && found.devices ? found.devices : [];\n    //   } else if (typeof this.contextSelected !== \"undefined\") {\n    //     const devices = [];\n    //     const found = this.data.find((el) => el.id === this.contextSelected);\n\n    //     if (found && found.networks) {\n    //       for (const network of found.networks) {\n    //         if (network.devices) {\n    //           devices.push(...network.devices);\n    //         }\n    //       }\n    //     }\n\n    //     return devices;\n    //   }\n    // },\n\n    // _formatBimProperty(bim) {\n    //   if (this.configuration.bimData.useFunction) {\n    //     return this._formatValue(\n    //       bim.property.displayValue,\n    //       this.configuration.bimData.callback.code\n    //     );\n    //   }\n\n    //   return bim.property.displayValue;\n    // },\n\n    // _formatBmsProperty(bms) {\n    //   if (this.configuration.bmsData.useFunction) {\n    //     return this._formatValue(\n    //       bms.property.displayValue,\n    //       this.configuration.bmsData.callback.code\n    //     );\n    //   }\n    //   return bms.property.displayValue;\n    // },\n\n    // _formatValue(value, callback) {\n    //   return eval(`(${callback})('${value}')`);\n    // },\n\n    // will be change\n    // getElementProperties(argItems, attributeName) {\n    //   const dbIdMap = new Map();\n    //   const promises = argItems.map(async (el) => {\n    //     const fileName = spinal.spinalGraphService\n    //       .getInfo(el.bimFileId)\n    //       .name.get();\n\n    //     const model = window.spinal.BimObjectService.getModelByName(fileName);\n\n    //     if (!model) throw \"make sure your load all scene\";\n\n    //     el.property = await AttributesUtilities.findAttribute(\n    //       model,\n    //       el.dbid,\n    //       attributeName\n    //     );\n    //     return el;\n    //   });\n\n    //   try {\n    //     return Promise.all(promises).then((result) => {\n    //       return {\n    //         validItems: result.filter((el) => el.property),\n    //         invalidItems: result.filter((el) => !el.property),\n    //       };\n    //     });\n    //   } catch (error) {\n    //     throw error;\n    //   }\n    // },\n\n    // _getItemPropertiesFormatted(model, itemList, attributeName, nodeId) {\n    //    const promises = itemList.map(async (el) => {\n    //       el.model = model;\n    //       el.property = this._getAttributeByName(\n    //          el.properties,\n    //          attributeName\n    //       );\n\n    //       return el;\n    //    });\n\n    //    return Promise.all(promises);\n    // },\n\n    // _getAttributeByName(properties, propertyName) {\n    //    return properties.find((obj) => {\n    //       return (\n    //          (obj.displayName === propertyName ||\n    //             obj.attributeName === propertyName) &&\n    //          obj.displayValue &&\n    //          (obj.displayValue + \"\").length > 0\n    //       );\n    //    });\n    // },\n\n    /* Selection */\n    selectContext(id) {\n      this.contextSelected = id;\n    },\n\n    selectNetwork(id) {\n      this.networkSelected = id;\n    },\n\n    selectDevice(id) {\n      this.deviceSelected = id;\n    },\n\n    /* Update */\n    updateNetworks() {\n      this.networks = [];\n      if (this.contextSelected) {\n        let val = this.data.find((el) => el.id === this.contextSelected);\n        if (val) this.networks = val.networks;\n      }\n    },\n\n    updateDevices() {\n      this.devices = [];\n      if (this.networkSelected) {\n        let val = this.networks.find((el) => el.id === this.networkSelected);\n        if (val) this.devices = val.devices;\n      }\n    },\n\n    /* Disabled */\n\n    disabledPreviousButton() {\n      return (\n        this.pageSelected === this.PAGES.loading ||\n        this.pageSelected === this.PAGES.selection ||\n        this.pageSelected === this.PAGES.success\n      );\n    },\n\n    disabledNextButton() {\n      /* !this.contextSelected || */\n      return (\n        (this.isAutomate && !this.deviceSelected) ||\n        // !this.networkSelected ||\n        !this.contextSelected ||\n        this.pageSelected === this.PAGES.loading ||\n        this.pageSelected === this.PAGES.result ||\n        this.pageSelected === this.PAGES.success\n      );\n    },\n\n    disabledLinkButton() {\n      return (\n        this.pageSelected === this.PAGES.loading ||\n        this.pageSelected !== this.PAGES.result ||\n        this.pageSelected === this.PAGES.success ||\n        this.pageSelected === this.PAGES.error\n      );\n    },\n  },\n  watch: {\n    async contextSelected() {\n      await this.updateNetworks();\n      this.networkSelected = undefined;\n    },\n\n    async networkSelected() {\n      this.updateDevices();\n      this.deviceSelected = undefined;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.mdDialogContainer {\n  width: 60%;\n  height: 600px;\n}\n\n.mdDialogContainer .dialogTitle {\n  text-align: center;\n}\n\n.mdDialogContainer .content {\n  padding: 0 10px 24px 24px;\n}\n\n.mdDialogContainer .content .state {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.mdDialogContainer .content .progress-bar {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.mdDialogContainer .content .progress-bar .percent-number {\n  font-size: 1.8em;\n  margin: 10px 0;\n}\n\n.mdDialogContainer .content .progress-bar .percent-bar {\n  width: 90%;\n}\n</style>\n\n<style>\n.mdDialogContainer .md-dialog-container {\n  max-width: 100%;\n  max-height: 100%;\n}\n</style>","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\nThis file is part of SpinalCore.\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n\t<div class=\"_container\">\n\t\t<div class=\"content\" v-if=\"isLoaded\">\n\t\t\t<md-list class=\"radios\">\n\t\t\t\t<md-list-item\n\t\t\t\t\tv-for=\"(item, index) in radios\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\tv-tooltip=\"item.name\"\n\t\t\t\t>\n\t\t\t\t\t<md-radio\n\t\t\t\t\t\tclass=\"md-primary\"\n\t\t\t\t\t\tv-model=\"attributeConfigSelected\"\n\t\t\t\t\t\t:value=\"item.id\"\n\t\t\t\t\t\t>{{ item.name }}</md-radio\n\t\t\t\t\t>\n\t\t\t\t</md-list-item>\n\n\t\t\t\t<md-list-item>\n\t\t\t\t\t<md-radio\n\t\t\t\t\t\tclass=\"md-primary\"\n\t\t\t\t\t\tv-model=\"attributeConfigSelected\"\n\t\t\t\t\t\t:value=\"-1\"\n\t\t\t\t\t\t:disabled=\"true\"\n\t\t\t\t\t\t><a @click=\"personalized\">Personalized</a></md-radio\n\t\t\t\t\t>\n\t\t\t\t</md-list-item>\n\t\t\t</md-list>\n\n\t\t\t<!-- <div class=\"md-layout md-gutter\">\n        <div class=\"md-layout-item md-size-33\">\n          <md-field>\n            <label>Attribute name</label>\n            <md-input v-model=\"attribute.attributeName\"></md-input>\n          </md-field>\n        </div>\n\n        <div class=\"md-layout-item md-size-33\">\n          <md-field>\n            <label>Separator</label>\n            <md-input v-model=\"attribute.separator\"></md-input>\n          </md-field>\n        </div>\n\n        <div class=\"md-layout-item md-size-33\">\n          <md-field>\n            <label>index</label>\n            <md-input v-model=\"attribute.indice\"\n                      type=\"number\"></md-input>\n          </md-field>\n        </div>\n      </div> -->\n\t\t</div>\n\t\t<div class=\"loading\" v-else>loading...</div>\n\t</div>\n</template>\n\n<script>\n\timport { DEFAULT_VALUES } from \"../../../js/attributeConfig\";\n\timport { spinalPanelManagerService } from \"spinal-env-viewer-panel-manager-service\";\n\texport default {\n\t\tname: \"configuration\",\n\t\tprops: {\n\t\t\t// data: {},\n\t\t\t// automateObj: {},\n\t\t\t// equipmentObj: {},\n\t\t\tattribute: {},\n\t\t},\n\t\tdata() {\n\t\t\tthis.radios = DEFAULT_VALUES;\n\t\t\treturn {\n\t\t\t\tattributeConfigSelected: \"\",\n\t\t\t\tisLoaded: true,\n\t\t\t};\n\t\t},\n\t\tmethods: {\n\t\t\trefresh() {\n\t\t\t\tthis.isLoaded = false;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.isLoaded = true;\n\t\t\t\t}, 300);\n\t\t\t},\n\t\t\t// goToNext() {\n\t\t\t//   this.$emit(\"next\", { id: \"first\", index: \"second\" });\n\t\t\t// }\n\t\t\tpersonalized() {\n\t\t\t\tspinalPanelManagerService.openPanel(\"personalizedAttributeDialog\", {\n\t\t\t\t\tisPersonalized: this.attributeConfigSelected == -1,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\tcallback: (useRegex, res) => {\n\t\t\t\t\t\tthis.attributeConfigSelected = -1;\n\t\t\t\t\t\tthis.attribute.isRegex = useRegex;\n\t\t\t\t\t\tif (useRegex) {\n\t\t\t\t\t\t\tthis.attribute.text = res.text;\n\t\t\t\t\t\t\tthis.attribute.flags = res.flags;\n\t\t\t\t\t\t\tthis.attribute.select = res.select;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.attribute.text = \"\";\n\t\t\t\t\t\t\tthis.attribute.flags = [];\n\t\t\t\t\t\t\tthis.attribute.select = \"\";\n\t\t\t\t\t\t\tthis.attribute.callback = res.code;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twatch: {\n\t\t\tattributeConfigSelected() {\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"attributeConfigSelected\",\n\t\t\t\t\tthis.attributeConfigSelected\n\t\t\t\t);\n\t\t\t\tif (this.attributeConfigSelected > -1) {\n\t\t\t\t\tconst found = this.radios.find(\n\t\t\t\t\t\t(el) => el.id == this.attributeConfigSelected\n\t\t\t\t\t);\n\t\t\t\t\tthis.attribute.isRegex = true;\n\t\t\t\t\tthis.attribute.text = found.value;\n\t\t\t\t\tthis.attribute.flags = found.flags || [];\n\t\t\t\t\tthis.attribute.select = found.select;\n\t\t\t\t}\n\n\t\t\t\tthis.$emit(\"changed\");\n\t\t\t},\n\t\t},\n\t};\n</script>\n\n<style scoped>\n\t._container {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tpadding: 0 0 0 0;\n\t}\n\t._container .content {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t/* .container .buttons {\n  width: 100%;\n  height: 10%;\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n} */\n</style>\n\n<style>\n\t._container\n\t\t.content\n\t\t.radios\n\t\t.md-list-item-content\n\t\t> .md-checkbox:first-child,\n\t._container .content .md-list-item-content > .md-radio:first-child {\n\t\twidth: 100%;\n\t\tmargin-right: 0px;\n\t}\n\n\t._container\n\t\t.content\n\t\t.radios\n\t\t.md-list-item-content\n\t\t> .md-checkbox:first-child,\n\t._container .content .md-list-item-content > .md-radio .md-radio-label {\n\t\twidth: calc(100% - 60px);\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n</style>\n","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\nThis file is part of SpinalCore.\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n\t<div class=\"content\">\n\t\t<div class=\"buttons\" v-if=\"appState === STATES.normal\">\n\t\t\t<md-button\n\t\t\t\tv-if=\"!verified\"\n\t\t\t\t:disabled=\"disableVerificationButton\"\n\t\t\t\tclass=\"md-raised md-primary\"\n\t\t\t\t@click=\"launchVerification\"\n\t\t\t>\n\t\t\t\tVerify\n\t\t\t</md-button>\n\n\t\t\t<div class=\"content-items\" v-else-if=\"verified\">\n\t\t\t\t<div class=\"content-item\">\n\t\t\t\t\t<md-button\n\t\t\t\t\t\tclass=\"resultVerification md-dense md-primary\"\n\t\t\t\t\t\t@click=\"selectItems(validItems)\"\n\t\t\t\t\t>\n\t\t\t\t\t\tValid item(s) :\n\t\t\t\t\t\t{{ validItems.length }}\n\t\t\t\t\t</md-button>\n\n\t\t\t\t\t<md-button\n\t\t\t\t\t\tclass=\"resultVerification md-dense md-accent\"\n\t\t\t\t\t\t@click=\"selectItems(invalidItems)\"\n\t\t\t\t\t>\n\t\t\t\t\t\tinvalid item(s) :\n\t\t\t\t\t\t{{ invalidItems.length }}\n\t\t\t\t\t</md-button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"content-item classifyContent\">\n\t\t\t\t\t<div class=\"checkbox\">\n\t\t\t\t\t\t<md-checkbox v-model=\"classify.class\" class=\"md-primary\"\n\t\t\t\t\t\t\t>Classify controllers By</md-checkbox\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"input\">\n\t\t\t\t\t\t<md-field>\n\t\t\t\t\t\t\t<label>Attribute name</label>\n\t\t\t\t\t\t\t<md-input\n\t\t\t\t\t\t\t\t:disabled=\"!classify.class\"\n\t\t\t\t\t\t\t\tv-model=\"classify.by\"\n\t\t\t\t\t\t\t></md-input>\n\t\t\t\t\t\t</md-field>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"content-item\">\n\t\t\t\t\t<md-checkbox v-model=\"dontCreateEmptyAutomate\" class=\"md-primary\"\n\t\t\t\t\t\t>Don't create Controllers which do not control\n\t\t\t\t\t\tequipment</md-checkbox\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"content-item\">\n\t\t\t\t\t<md-button\n\t\t\t\t\t\t:disabled=\"error\"\n\t\t\t\t\t\tclass=\"md-raised md-primary\"\n\t\t\t\t\t\t@click=\"launchGeneration\"\n\t\t\t\t\t\t>Launch Generation</md-button\n\t\t\t\t\t>\n\n\t\t\t\t\t<!--  \n               <md-button\n                  :disabled=\"error\"\n                  class=\"md-raised md-primary\"\n               >Edit Links</md-button>-->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"state\" v-else-if=\"appState === STATES.loading\">\n\t\t\t<md-progress-spinner md-mode=\"indeterminate\"></md-progress-spinner>\n\t\t</div>\n\n\t\t<div class=\"progress-bar\" v-else-if=\"appState === STATES.creation\">\n\t\t\t<div class=\"percent-number\">{{ percent }} %</div>\n\t\t\t<!-- md-mode=\"determinate\" -->\n\t\t\t<md-progress-bar\n\t\t\t\tclass=\"percent-bar\"\n\t\t\t\tmd-mode=\"buffer\"\n\t\t\t\t:md-value=\"percent\"\n\t\t\t></md-progress-bar>\n\t\t</div>\n\n\t\t<div class=\"state\" v-else-if=\"appState === STATES.success\">\n\t\t\t<md-icon class=\"md-size-4x\">check</md-icon>\n\t\t</div>\n\n\t\t<div class=\"state\" v-else-if=\"appState === STATES.error\">\n\t\t\t<md-icon class=\"md-size-4x\">close</md-icon>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n\timport { SpinalGraphService } from \"spinal-env-viewer-graph-service\";\n\t// // import { SpinalGraphService } from \"spinal-env-viewer-graph-service\";\n\t// import generateAutomateService from \"../../../js/generateAutomateService\";\n\t// import spinalNetworkTreeService from \"../../../services/index\";\n\n\timport {\n\t\tNetworkTreeService,\n\t\tGenerateNetworkTreeService,\n\t\tAttributesUtilities,\n\t\tCONSTANTS,\n\t} from \"spinal-env-viewer-plugin-network-tree-service\";\n\n\texport default {\n\t\tname: \"launchGeneration\",\n\t\tprops: {\n\t\t\tautomatesObj: {},\n\t\t\tequipmentsObj: {},\n\t\t\tattribute: {},\n\t\t\terror: {},\n\t\t\tcontextId: {},\n\t\t\tselectedNodeId: {},\n\t\t\tchanged: {},\n\t\t\tnamingConvention: {},\n\t\t},\n\t\tdata() {\n\t\t\tthis.STATES = {\n\t\t\t\tloading: 1,\n\t\t\t\tnormal: 2,\n\t\t\t\tcreation: 3,\n\t\t\t\tsuccess: 4,\n\t\t\t\terror: 5,\n\t\t\t};\n\t\t\t// this.automatesVerificationResult = {};\n\t\t\t// this.equipementsVerificationResult = {};\n\n\t\t\tthis.tree = [];\n\n\t\t\treturn {\n\t\t\t\tpercent: 0,\n\t\t\t\tverified: false,\n\t\t\t\tvalueGrouped: null,\n\t\t\t\tappState: this.STATES.normal,\n\t\t\t\tvalidItems: [],\n\t\t\t\tinvalidItems: [],\n\t\t\t\tdontCreateEmptyAutomate: true,\n\t\t\t\tclassify: {\n\t\t\t\t\tclass: true,\n\t\t\t\t\tby: \"Niveau\",\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tmethods: {\n\t\t\tasync launchVerification() {\n\t\t\t\tthis.appState = this.STATES.loading;\n\t\t\t\tthis.formatData().then(\n\t\t\t\t\t({ automatesProperties, equipementsProperties }) => {\n\t\t\t\t\t\treturn GenerateNetworkTreeService.createTree(\n\t\t\t\t\t\t\tautomatesProperties,\n\t\t\t\t\t\t\tequipementsProperties,\n\t\t\t\t\t\t\tthis.attribute\n\t\t\t\t\t\t).then(({ tree, invalids, valids }) => {\n\t\t\t\t\t\t\tthis.tree = tree;\n\t\t\t\t\t\t\tthis.validItems = valids;\n\t\t\t\t\t\t\tthis.invalidItems = invalids;\n\n\t\t\t\t\t\t\tthis.verified = true;\n\t\t\t\t\t\t\tthis.appState = this.STATES.normal;\n\t\t\t\t\t\t\tthis.$emit(\"verified\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// this.automatesVerificationResult = result.automatesProperties;\n\t\t\t\t\t\t// this.equipementsVerificationResult = result.equipementsProperties;\n\t\t\t\t\t\t//    this.verified = true;\n\t\t\t\t\t\t//    this.appState = this.STATES.normal;\n\t\t\t\t\t\t//    this.$emit(\"verified\");\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tasync launchGeneration() {\n\t\t\t\tthis.appState = this.STATES.creation;\n\t\t\t\tlet tree = [...this.tree];\n\n\t\t\t\tif (this.dontCreateEmptyAutomate) {\n\t\t\t\t\ttree = this.tree.filter((el) => el.children.length > 0);\n\t\t\t\t}\n\n\t\t\t\tconst Listelength = tree.length;\n\t\t\t\tlet isError = false;\n\n\t\t\t\twhile (!isError && tree.length > 0) {\n\t\t\t\t\tconst item = tree.shift();\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (item) {\n\t\t\t\t\t\t\tconst parentId = await this.getOrCreateParentId(\n\t\t\t\t\t\t\t\tthis.contextId,\n\t\t\t\t\t\t\t\tthis.selectedNodeId,\n\t\t\t\t\t\t\t\titem\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconsole.log(\"parentId\", item);\n\n\t\t\t\t\t\t\tawait GenerateNetworkTreeService._createNodes(\n\t\t\t\t\t\t\t\tthis.contextId,\n\t\t\t\t\t\t\t\titem,\n\t\t\t\t\t\t\t\tparentId\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.percent = Math.floor(\n\t\t\t\t\t\t\t\t(100 * (Listelength - tree.length)) / Listelength\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\tisError = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (isError) {\n\t\t\t\t\tthis.appState = this.STATES.error;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.appState = this.STATES.success;\n\t\t\t},\n\n\t\t\t// createNode(liste, contextId, nodeId, Listelength) {\n\t\t\t//    return new Promise((resolve, reject) => {\n\t\t\t//       this.createNodeRecur(\n\t\t\t//          liste,\n\t\t\t//          contextId,\n\t\t\t//          nodeId,\n\t\t\t//          Listelength,\n\t\t\t//          resolve\n\t\t\t//       );\n\t\t\t//    });\n\t\t\t// },\n\n\t\t\t// async createNodeRecur(liste, contextId, nodeId, Listelength, resolve) {\n\t\t\t//    const item = liste.shift();\n\t\t\t//    if (item) {\n\t\t\t//       const parentId = await this.getOrCreateParentId(\n\t\t\t//          contextId,\n\t\t\t//          nodeId,\n\t\t\t//          item\n\t\t\t//       );\n\n\t\t\t//       GenerateNetworkTreeService._createNodes(contextId, item, parentId)\n\t\t\t//          .then(() => {\n\t\t\t//             this.percent = Math.floor(\n\t\t\t//                (100 * (Listelength - liste.length)) / Listelength\n\t\t\t//             );\n\n\t\t\t//             this.createNodeRecur(\n\t\t\t//                liste,\n\t\t\t//                contextId,\n\t\t\t//                nodeId,\n\t\t\t//                Listelength,\n\t\t\t//                resolve\n\t\t\t//             );\n\t\t\t//          })\n\t\t\t//          .catch((err) => {\n\t\t\t//             console.error(err);\n\t\t\t//             this.percent = Math.floor(\n\t\t\t//                (100 * (Listelength - liste.length)) / Listelength\n\t\t\t//             );\n\n\t\t\t//             this.createNodeRecur(\n\t\t\t//                liste,\n\t\t\t//                contextId,\n\t\t\t//                nodeId,\n\t\t\t//                Listelength,\n\t\t\t//                resolve\n\t\t\t//             );\n\t\t\t//          });\n\t\t\t//    } else {\n\t\t\t//       resolve(true);\n\t\t\t//    }\n\t\t\t// },\n\n\t\t\tasync getOrCreateParentId(contextId, nodeId, item) {\n\t\t\t\tif (!this.classify.class) {\n\t\t\t\t\treturn nodeId;\n\t\t\t\t}\n\n\t\t\t\tconst val = this.classify.by;\n\n\t\t\t\t// const found = item.properties.find(\n\t\t\t\t//    (el) => el.attributeName == val || el.displayName == val\n\t\t\t\t// );\n\t\t\t\tconst found = await AttributesUtilities.findAttribute(\n\t\t\t\t\titem.model,\n\t\t\t\t\titem.dbId,\n\t\t\t\t\tval\n\t\t\t\t);\n\n\t\t\t\tconst parentName =\n\t\t\t\t\tfound && found.displayValue ? found.displayValue : \"Others\";\n\n\t\t\t\tconst children = await SpinalGraphService.getChildren(nodeId, [\n\t\t\t\t\t// spinalNetworkTreeService.constants.NETWORK_RELATION,\n\t\t\t\t\tCONSTANTS.NETWORK_RELATION,\n\t\t\t\t]);\n\n\t\t\t\tconst parentFound = children.find(\n\t\t\t\t\t(el) => el.name.get() == parentName\n\t\t\t\t);\n\n\t\t\t\tif (parentFound) return parentFound.id.get();\n\n\t\t\t\t// const parent = await spinalNetworkTreeService.addNetwork(\n\t\t\t\t//    parentName,\n\t\t\t\t//    nodeId,\n\t\t\t\t//    contextId\n\t\t\t\t// );\n\n\t\t\t\tconst parent = await NetworkTreeService.addNetwork(\n\t\t\t\t\tparentName,\n\t\t\t\t\tnodeId,\n\t\t\t\t\tcontextId\n\t\t\t\t);\n\n\t\t\t\tSpinalGraphService._addNode(parent);\n\t\t\t\treturn parent.getId().get();\n\t\t\t},\n\n\t\t\t_displayResult(result) {\n\t\t\t\tthis.appState = result;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.appState = this.STATES.normal;\n\t\t\t\t}, 1000);\n\t\t\t},\n\n\t\t\tformatData() {\n\t\t\t\tconst promises = [\n\t\t\t\t\tGenerateNetworkTreeService.getElementProperties(\n\t\t\t\t\t\tthis.automatesObj.items,\n\t\t\t\t\t\tthis.automatesObj.attributeName,\n\t\t\t\t\t\tthis.namingConvention\n\t\t\t\t\t),\n\t\t\t\t\tGenerateNetworkTreeService.getElementProperties(\n\t\t\t\t\t\tthis.equipmentsObj.items,\n\t\t\t\t\t\tthis.equipmentsObj.attributeName,\n\t\t\t\t\t\tthis.namingConvention\n\t\t\t\t\t),\n\t\t\t\t];\n\n\t\t\t\treturn Promise.all(promises).then((result) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tautomatesProperties: result[0] && result[0].validItems,\n\t\t\t\t\t\tequipementsProperties: result[1] && result[1].validItems,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tselectItems(argItems) {\n\t\t\t\tconst items =\n\t\t\t\t\tGenerateNetworkTreeService.classifyDbIdsByModel(argItems);\n\t\t\t\twindow.spinal.ForgeViewer.viewer.impl.selector.setAggregateSelection(\n\t\t\t\t\titems\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\tcomputed: {\n\t\t\tdisableVerificationButton() {\n\t\t\t\treturn (\n\t\t\t\t\t(this.automatesObj.items.length === 0 &&\n\t\t\t\t\t\tthis.automatesObj.attributeName.trim().length === 0) ||\n\t\t\t\t\t(this.equipmentsObj.items.length === 0 &&\n\t\t\t\t\t\tthis.equipmentsObj.attributeName.trim().length === 0)\n\t\t\t\t);\n\t\t\t},\n\t\t},\n\t\twatch: {\n\t\t\tchanged() {\n\t\t\t\tif (this.changed) {\n\t\t\t\t\tthis.appState = this.STATES.normal;\n\t\t\t\t\tthis.verified = false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// attribute() {\n\t\t\t//   this.verified = false;\n\t\t\t// }\n\t\t},\n\t};\n</script>\n\n<style scoped>\n\t.content {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t.content .buttons {\n\t\twidth: 100%;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t}\n\n\t.content .buttons .content-items {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\n\t.content .buttons .content-items .content-item {\n\t\twidth: 100%;\n\t\theight: 50px;\n\t\tmargin-bottom: 5px;\n\t}\n\n\t.content .buttons .content-items .content-item.classifyContent {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t/* .content\n   .buttons\n   .content-items\n   .content-item.content-item.classifyContent\n   .checkbox {\n}\n\n.content\n   .buttons\n   .content-items\n   .content-item.content-item.classifyContent\n   .input {\n} */\n\n\t.state {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\t.progress-bar {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.progress-bar .percent-number {\n\t\tfont-size: 1.8em;\n\t\tmargin: 10px 0;\n\t}\n\t.progress-bar .percent-bar {\n\t\twidth: 90%;\n\t}\n</style>\n","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\nThis file is part of SpinalCore.\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n   <div class=\"sub-content\">\n\n      <div class=\"countdiv\">\n         {{count}} item(s) selected\n      </div>\n\n      <div class=\"buttons\">\n         <md-button @click=\"addSelection\">\n            <md-icon>add</md-icon>\n            <md-tooltip md-delay=\"300\">Add Bim objects selected</md-tooltip>\n         </md-button>\n\n         <md-button @click=\"clearReferential\">\n            <md-icon>clear</md-icon>\n            <md-tooltip md-delay=\"300\">Clear selected</md-tooltip>\n         </md-button>\n\n         <md-button @click=\"showReferential\">\n            <md-icon>visibility</md-icon>\n            <md-tooltip md-delay=\"300\">Show referential</md-tooltip>\n         </md-button>\n      </div>\n\n      <div>\n         <md-field>\n            <label>Attribute</label>\n            <md-input v-model=\"config.attributeName\"></md-input>\n         </md-field>\n      </div>\n\n      <div>\n         <div v-if=\"displayResult\">\n            <md-button\n               class=\"md-dense md-primary\"\n               @click=\"selectValidItemsOnModel\"\n            >\n               {{validItems.length}} item(s) is/are valid\n            </md-button>\n\n            <md-button\n               class=\"md-dense md-accent\"\n               @click=\"selectInvalidItemsOnModel\"\n            >\n               {{invalidItems.length}} item(s) is/are not valid\n            </md-button>\n         </div>\n\n         <md-button\n            v-if=\"!loadAttributeResult\"\n            :disabled=\"displayResult\"\n            class=\"md-raised md-primary\"\n            @click=\"verifyResult\"\n         >Verify</md-button>\n\n         <md-progress-spinner\n            v-if=\"loadAttributeResult\"\n            :md-diameter=\"30\"\n            :md-stroke=\"3\"\n            md-mode=\"indeterminate\"\n         ></md-progress-spinner>\n      </div>\n\n   </div>\n</template>\n\n<script>\nimport geographicService from \"spinal-env-viewer-context-geographic-service\";\nimport { bimObjectManagerService } from \"spinal-env-viewer-bim-manager-service\";\n// import generateAutomateService from \"../../../js/generateAutomateService\";\n\nimport { GenerateNetworkTreeService } from \"spinal-env-viewer-plugin-network-tree-service\";\n\nexport default {\n   name: \"selectionStep\",\n   props: {\n      config: {},\n   },\n   data() {\n      return {\n         validItems: [],\n         invalidItems: [],\n         loadAttributeResult: false,\n         displayResult: false,\n         count: 0,\n      };\n   },\n   methods: {\n      async addSelection() {\n         await this.addItemSelected();\n         this.changeItemCount();\n         this.displayResult = false;\n         this.$emit(\"changed\");\n      },\n\n      clearReferential() {\n         this.config.items = [];\n         this.changeItemCount();\n         this.displayResult = false;\n         this.$emit(\"changed\");\n\n         // this.changeItemCount();\n\n         //  this.$emit(\"clear\");\n      },\n\n      async addItemSelected() {\n         const aggregateSelection = window.spinal.ForgeViewer.viewer.getAggregateSelection();\n\n         if (aggregateSelection.length === 0) {\n            window.alert(\"no bim object selected\");\n            return;\n         }\n\n         const selection = await this.getLeafDbIds(aggregateSelection);\n\n         for (const element of selection) {\n            this.addItemToList(element);\n         }\n\n         // let promisesValues = await Promise.all(nodespromises);\n         // for (const iterator of promisesValues) {\n         //   const listeFiltered = this.filterList(iterator);\n         //   this.config.items = [...this.config.items, ...listeFiltered];\n         // }\n      },\n\n      getLeafDbIds(selections) {\n         const dbIds = selections.map((el) => {\n            return bimObjectManagerService.getLeafDbIds(el.model, el.selection);\n         });\n         return Promise.all(dbIds);\n      },\n\n      addItemToList({ model, selection }) {\n         const elementFound = this.config.items.find(\n            (el) => el.model.id === model.id\n         );\n\n         if (!elementFound) {\n            this.config.items.push({ model, selection });\n            return;\n         }\n\n         for (const dbId of selection) {\n            const found = elementFound.selection.find((el) => el === dbId);\n            if (!found) elementFound.selection.push(dbId);\n         }\n      },\n\n      changeItemCount() {\n         this.count = 0;\n         for (const item of this.config.items) {\n            this.count += item.selection.length;\n         }\n      },\n\n      showReferential() {\n         // const items = this.config.items.map(({ model, selection }) => {\n         //    return { model, ids: selection };\n         // });\n         // window.spinal.ForgeViewer.viewer.impl.selector.setAggregateSelection(\n         //    items\n         // );\n\n         this.config.items.forEach(({ model, selection }) => {\n            window.spinal.ForgeViewer.viewer.impl.selector.setSelection(\n               selection,\n               model\n            );\n         });\n      },\n\n      verifyResult() {\n         this.loadAttributeResult = true;\n         GenerateNetworkTreeService.getElementProperties(\n            this.config.items,\n            this.config.attributeName\n         ).then((result) => {\n            this.validItems = result.validItems;\n            this.invalidItems = result.invalidItems;\n            this.displayResult = true;\n            this.loadAttributeResult = false;\n         });\n      },\n\n      selectValidItemsOnModel() {\n         const items = GenerateNetworkTreeService.classifyDbIdsByModel(\n            this.validItems\n         );\n\n         window.spinal.ForgeViewer.viewer.impl.selector.setAggregateSelection(\n            items\n         );\n      },\n\n      selectInvalidItemsOnModel() {\n         const items = GenerateNetworkTreeService.classifyDbIdsByModel(\n            this.invalidItems\n         );\n\n         window.spinal.ForgeViewer.viewer.impl.selector.setAggregateSelection(\n            items\n         );\n      },\n   },\n   watch: {\n      // config: {\n      //    items() {\n      //       this.changeItemCount();\n      //    },\n      // },\n   },\n};\n</script>\n\n<style scoped>\n.countdiv {\n   height: 60px;\n   display: flex;\n   align-items: center;\n   font-size: 1.2em;\n}\n</style>\n\n<style>\n.sub-content .buttons .md-button .md-ripple {\n   padding: 0px !important;\n}\n</style>","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n   <div class=\"generation_container\">\n      <md-steppers\n         md-vertical\n         class=\"steppers\"\n         :md-dynamic-height=\"true\"\n         @md-changed=\"changeStep\"\n      >\n\n         <md-step\n            id=\"first\"\n            md-label=\"Controller selection\"\n            md-description=\"Select all controllers\"\n         >\n            <div class=\"step-container md-scrollbar\">\n               <selection-step\n                  :config=\"data.objAutomate\"\n                  @clear=\"clearAutomates\"\n                  @changed=\"() => this.changed = true\"\n               ></selection-step>\n            </div>\n\n         </md-step>\n\n         <md-step\n            id=\"second\"\n            md-label=\"Selection of controlled objects\"\n            md-description=\"Select all controlled objects\"\n         >\n            <md-content class=\"step-container md-scrollbar\">\n               <selection-step\n                  :config=\"data.objEquipment\"\n                  @clear=\"clearEquipments\"\n                  @changed=\"() => this.changed = true\"\n               ></selection-step>\n            </md-content>\n         </md-step>\n\n         <md-step\n            id=\"third\"\n            md-label=\"Configuration Controllers and objects association\"\n            md-description=\"Wich objects are controlled by which controller\"\n            :md-error=\"errorInConfig\"\n         >\n            <md-content class=\"step-container md-scrollbar\">\n               <configuration-step\n                  :automateObj=\"data.objAutomate\"\n                  :equipmentObj=\"data.objEquipment\"\n                  :attribute=\"data.attribute\"\n                  @changed=\"() => this.changed = true\"\n               ></configuration-step>\n            </md-content>\n\n         </md-step>\n\n         <md-step\n            id=\"fourth\"\n            md-label=\"Configure naming Convention\"\n            md-description=\"create the network tree structure\"\n         >\n            <naming-convention-step :config=\"data.namingConvention\"></naming-convention-step>\n         </md-step>\n\n         <md-step\n            id=\"fifth\"\n            md-label=\"Creation Step\"\n            md-description=\"create the network tree structure\"\n         >\n\n            <div class=\"step-container md-scrollbar\">\n               <launch-generation-step\n                  :automatesObj=\"data.objAutomate\"\n                  :equipmentsObj=\"data.objEquipment\"\n                  :attribute=\"data.attribute\"\n                  :namingConvention=\"data.namingConvention\"\n                  :contextId=\"contextId\"\n                  :selectedNodeId=\"selectedNodeId\"\n                  :changed=\"changed\"\n                  @verified=\"() => this.changed = false\"\n               >\n               </launch-generation-step>\n            </div>\n\n         </md-step>\n\n      </md-steppers>\n   </div>\n</template>\n\n<script>\nimport ConfigurationStep from \"../components/steps/configurationStep.vue\";\nimport launchGenerationStep from \"../components/steps/launchStep.vue\";\nimport selectionStep from \"../components/steps/selectionStep.vue\";\nimport namingConventionStep from \"../components/steps/namingConventionStep.vue\";\n\nimport { CONSTANTS } from \"spinal-env-viewer-plugin-network-tree-service\";\n\n// import { OBJECT_ATTR } from \"../../js/attributeConfig\";\n\nexport default {\n   name: \"heatmapPanel\",\n   components: {\n      \"configuration-step\": ConfigurationStep,\n      \"launch-generation-step\": launchGenerationStep,\n      \"selection-step\": selectionStep,\n      \"naming-convention-step\": namingConventionStep,\n   },\n   data() {\n      return {\n         changed: false,\n         active: \"first\",\n         first: false,\n         second: false,\n         third: false,\n         firstStepError: false,\n         errorInConfig: null,\n         contextId: \"\",\n         selectedNodeId: \"\",\n         data: {\n            objAutomate: {\n               attributeName: \"CFA_Repre d'quipement\",\n               // attributeName: \"CFA_Code quipement\",\n               items: [],\n            },\n            objEquipment: {\n               attributeName: \"CFA_Repre d'quipement\",\n               // attributeName: \"CFA_Code quipement\",\n               items: [],\n            },\n            attribute: {\n               isRegex: true,\n               text: \"\",\n               flags: [],\n               select: CONSTANTS.OBJECT_ATTR,\n               callback: () => {},\n            },\n            namingConvention: {\n               attributeName: \"CFA_Repre d'quipement\",\n               useAttrValue: true,\n               personalized: {\n                  callback: () => {},\n               },\n            },\n            // attribute: {\n            //    id: Date.now(),\n            //    attributeName: \"Attribut GTB\",\n            //    separator: \"_\",\n            //    indice: 3,\n            // },\n         },\n         errors: {\n            firstStep: { error: false, message: \"\" },\n            secondStep: { error: false, message: \"\" },\n            thirdStep: { error: false, message: \"\" },\n         },\n      };\n   },\n   methods: {\n      async opened(option) {\n         this.contextId = option.context.id;\n         this.selectedNodeId = option.selectedNode.id;\n      },\n\n      closed() {},\n\n      clearAutomates() {\n         this.data.objAutomate.items = [];\n         this.changed = true;\n      },\n\n      clearEquipments() {\n         this.data.objEquipment.items = [];\n         this.changed = true;\n      },\n\n      errorInFirstStep() {\n         this.errorInConfig = \"This is an error!\";\n      },\n\n      changeStep(step) {},\n   },\n   computed: {\n      // attribute_attributeName() {\n      //    return this.data.attribute.attributeName;\n      // },\n      // attribute_separator() {\n      //    return this.data.attribute.separator;\n      // },\n      // attribute_indice() {\n      //    return this.data.attribute.indice;\n      // },\n   },\n   watch: {\n      attribute_attributeName() {\n         this.changed = true;\n      },\n\n      attribute_separator() {\n         this.changed = true;\n      },\n\n      attribute_indice() {\n         this.changed = true;\n      },\n   },\n};\n</script>\n\n<style scoped>\n.generation_container {\n   width: 100%;\n   height: 100%;\n   padding: unset;\n}\n\n.generation_container .selection_content {\n   width: 100%;\n   min-height: 150px;\n   display: flex;\n   flex-direction: column;\n}\n\n.generation_container .selection_content .text {\n   width: 100%;\n   height: 50px;\n   display: flex;\n   align-items: center;\n   justify-content: center;\n}\n\n.generation_container .attribute {\n   padding: 0px 10px 0px 10px;\n}\n\n.generation_container .selection_content .buttons {\n   display: flex;\n   justify-content: center;\n   align-items: center;\n}\n\n.generation_container .launch_content {\n   display: flex;\n   justify-content: center;\n   align-items: center;\n}\n</style>\n\n<style>\n/*\n.generation_container .attribute {\n}\n\n.generation_container .launch_content .md-button {\n}*/\n</style>\n\n<style>\n.generation_container .steppers .md-field {\n   min-height: unset;\n}\n</style>","<!--\nCopyright 2020 SpinalCom - www.spinalcom.com\n\nThis file is part of SpinalCore.\n\nPlease read all of the following terms and conditions\nof the Free Software license Agreement (\"Agreement\")\ncarefully.\n\nThis Agreement is a legally binding contract between\nthe Licensee (as defined below) and SpinalCom that\nsets forth the terms and conditions that govern your\nuse of the Program. By installing and/or using the\nProgram, you agree to abide by all the terms and\nconditions stated or referenced herein.\n\nIf you do not agree to abide by these terms and\nconditions, do not demonstrate your acceptance and do\nnot install or use the Program.\nYou should have received a copy of the license along\nwith this file. If not, see\n<http://resources.spinalcom.com/licenses.pdf>.\n-->\n\n<template>\n   <md-content class=\"myContainer md-scrollbar\">\n\n      <div class=\"header\">\n         <md-button\n            class=\"md-primary exportBtn\"\n            @click=\"exportFile\"\n         >Export</md-button>\n      </div>\n\n      <md-table\n         v-if=\"itemSelected\"\n         v-model=\"data\"\n         class=\"myTable md-scrollbar\"\n      >\n         <!-- <md-table-toolbar>\n      <h1 class=\"md-title\">Users</h1>\n    </md-table-toolbar> -->\n\n         <md-table-empty-state\n            md-label=\"No element found\"\n            md-description=\"No bim object found in this context\"\n         >\n         </md-table-empty-state>\n\n         <md-table-row\n            slot=\"md-table-row\"\n            slot-scope=\"{ item }\"\n         >\n\n            <md-table-cell\n               md-label=\"Id\"\n               md-numeric\n               :title=\"item.externalId\"\n               class=\"tableColumn\"\n            >{{ item.externalId }}\n            </md-table-cell>\n\n            <md-table-cell\n               md-label=\"Name\"\n               :title=\"item.name\"\n               class=\"tableColumn\"\n            >{{ item.name }}</md-table-cell>\n\n            <md-table-cell\n               md-label=\"Parent(s)\"\n               :title=\"formatParents(item)\"\n               class=\"tableColumn\"\n            >{{ formatParents(item)}}\n            </md-table-cell>\n\n            <md-table-cell\n               md-label=\"Group(s)\"\n               :title=\"formatGroups(item)\"\n               class=\"tableColumn\"\n            >{{ formatGroups(item) }}\n            </md-table-cell>\n\n         </md-table-row>\n      </md-table>\n   </md-content>\n</template>\n\n<script>\nconst {\n   spinalPanelManagerService,\n} = require(\"spinal-env-viewer-panel-manager-service\");\n\n// import spinalNetworktree from \"../../services\";\n\nimport { NetworkTreeService } from \"spinal-env-viewer-plugin-network-tree-service\";\n\nimport spinalExcelManager from \"spinal-env-viewer-plugin-excel-manager-service\";\nimport FileSaver from \"file-saver\";\n\nexport default {\n   name: \"networkTreeDetailPanel\",\n   data() {\n      return {\n         itemSelected: null,\n         data: [],\n      };\n   },\n   methods: {\n      opened(params) {\n         this.itemSelected = params;\n      },\n\n      closed() {},\n\n      setTitle(title) {\n         spinalPanelManagerService.panels.networkTreeDetailPanel.panel.setTitle(\n            title\n         );\n      },\n\n      getAllData(contextId) {\n         // return spinalNetworktree\n         return NetworkTreeService.getNetworkTreeBimObjects(contextId).then(\n            (bimObjects) => {\n               let promises = bimObjects.map(async (el) => {\n                  let info = el.info.get();\n                  // info[\"groups\"] = await spinalNetworktree.getNetworkGroups(info.id);\n                  info[\"groups\"] = await NetworkTreeService.getNetworkGroups(\n                     info.id\n                  );\n                  // info[\"parents\"] = await spinalNetworktree.getNetworkBimObjectParents(info.id);\n                  info[\n                     \"parents\"\n                  ] = await NetworkTreeService.getNetworkBimObjectParents(\n                     info.id\n                  );\n                  return info;\n               });\n\n               return Promise.all(promises);\n            }\n         );\n      },\n      formatParents(item) {\n         let parentsDbIds = item.parents.map((el) => el.externalId);\n         return parentsDbIds.length > 0 ? parentsDbIds.join(\", \") : \"-\";\n      },\n      formatGroups(item) {\n         let groupsNames = item.groups.map((el) => el.name);\n         return groupsNames.length > 0 ? groupsNames.join(\", \") : \"-\";\n      },\n\n      getHeader() {\n         return [\n            {\n               key: \"bimFileId\",\n               header: \"BimFileId\",\n               width: 20,\n            },\n            {\n               key: \"dbid\",\n               header: \"Dbid\",\n               width: 20,\n            },\n            {\n               key: \"externalId\",\n               header: \"ExternalId\",\n               width: 20,\n            },\n            {\n               key: \"name\",\n               header: \"Name\",\n               width: 20,\n            },\n            {\n               key: \"type\",\n               header: \"Type\",\n               width: 20,\n            },\n            {\n               key: \"parent\",\n               header: \"Parent(s)\",\n               width: 20,\n            },\n            {\n               key: \"group\",\n               header: \"Group(s)\",\n               width: 20,\n            },\n         ];\n      },\n\n      getRows() {\n         return this.data.map((el) => {\n            el[\"group\"] = this.formatGroups(el);\n            el[\"parent\"] = this.formatParents(el);\n            return el;\n         });\n      },\n\n      exportFile() {\n         let result = [\n            {\n               name: `Network Tree ${this.itemSelected.name}`,\n               author: \"spinalcom\",\n               data: [\n                  {\n                     name: `Network Tree ${this.itemSelected.name}`,\n                     header: this.getHeader(),\n                     rows: this.getRows(),\n                  },\n               ],\n            },\n         ];\n\n         spinalExcelManager.export(result).then((buffer) => {\n            FileSaver.saveAs(new Blob(buffer), `spinalcom.xlsx`);\n         });\n      },\n   },\n   watch: {\n      itemSelected() {\n         this.getAllData(this.itemSelected.id).then((objects) => {\n            this.setTitle(`Network Tree : ${this.itemSelected.name}`);\n            this.data = objects;\n         });\n      },\n   },\n};\n</script>\n\n<style scoped>\n.myContainer {\n   width: calc(100%);\n   height: calc(100%);\n   overflow: auto;\n}\n\n.myContainer .header {\n   width: calc(100%);\n   height: calc(10% - 10px);\n   margin-bottom: 10px;\n   display: flex;\n   justify-content: flex-end;\n}\n\n.myContainer .mytable {\n   width: calc(80%);\n   height: calc(90%);\n   margin: 10px;\n}\n\n.exportBtn {\n   border: 1px solid #448aff;\n   width: 150px;\n}\n\n/* .tableColumn {\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n} */\n</style>"],"names":[],"version":3,"file":"spinal-env-viewer-plugin-network-tree.5f0727b9.css.map"}